[
  {
    "name": "replay_projection_excludes_unreferenced_payload_field",
    "input_commands": [
      "DEFINE product FIELDS { \"name\": \"string\", \"price\": \"int\", \"color\": \"string\" }",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Desk\",\"price\":25,\"color\":\"red\"}",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Chair\",\"price\":50,\"color\":\"blue\"}",
      "FLUSH",
      "REPLAY product FOR user-1 RETURN [name]"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["Desk", "Chair"] },
      { "kind": "include_none", "value": ["\"color\"", "\"price\""] }
    ]
  },
  {
    "name": "store_without_definition",
    "input_commands": [
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "No schema defined"
    }
  },
  {
    "name": "projection_excludes_unreferenced_payload_field",
    "input_commands": [
      "DEFINE product FIELDS { \"name\": \"string\", \"price\": \"int\", \"color\": \"string\" }",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Desk\",\"price\":25,\"color\":\"red\"}",
      "FLUSH",
      "QUERY product RETURN [name] WHERE price > 10"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "Desk"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "\"color\""
        ]
      }
    ]
  },
  {
    "name": "store_and_query_enum_eq",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-1 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR user-2 PAYLOAD {\"plan\": \"basic\"}",
      "QUERY subscription WHERE plan=\"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-2"
        ]
      }
    ]
  },
  {
    "name": "store_and_query_enum_neq",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-3 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR user-4 PAYLOAD {\"plan\": \"basic\"}",
      "QUERY subscription WHERE plan!=\"basic\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-4"
        ]
      }
    ]
  },
  {
    "name": "store_with_invalid_enum_value",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-1 PAYLOAD {\"plan\": \"enterprise\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "does not match expected type"
    }
  },
  {
    "name": "store_with_invalid_payload",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\": \"a string\",\"status\":\"confirmed\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Field 'order_id' does not match expected type"
    }
  },
  {
    "name": "store_with_missing_field",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Missing field 'status' in payload"
    }
  },
  {
    "name": "store_with_invalid_field_type",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\", \"invalid_field\": \"a string\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Payload contains fields not defined in schema: invalid_field"
    }
  },
  {
    "name": "store_with_optional_field_present",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\", \"optional_field\": \"string | null\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":123, \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":124, \"status\":\"confirmed\"}",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "123",
        "124"
      ]
    }
  },
  {
    "name": "query_with_optional_field",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"string\", \"status\": \"string\", \"optional_field\": \"string | null\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-123\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-124\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-125\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-126\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-127\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-128\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-129\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-130\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-131\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-132\", \"status\":\"confirmed\"}",
      "QUERY order_created WHERE optional_field=\"a string\""
    ],
    "matchers": [
      {
      "kind": "include_all",
      "value": [
        "order-123",
        "order-126",
        "order-128",
        "order-130",
        "order-131"
      ]
    },
    {
      "kind": "include_none",
      "value": [
        "order-124",
        "order-125",
        "order-127",
        "order-129",
        "order-132"
      ]
    }
    ]
  },
  {
    "name": "simple_query_status_confirmed",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-2 PAYLOAD {\"order_id\":2,\"status\":\"pending\"}",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"order_id\":1",
        "\"status\":\"confirmed\""
      ]
    }
  },
  {
    "name": "simple_query_with_mixed_commands",
    "input_commands": [
      "define order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "Store order_created FoR customer-1 PAYLOAD {\"order_id\":123,\"status\":\"confirmed\"}",
      "STORe order_created For customer-2 PAYLOAD {\"order_id\":124,\"status\":\"pending\"}",
      "query order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "123"
      ]
    }
  },
  {
    "name": "segment_memory_hybrid_query",
    "config": {
      "engine": { "fill_factor": 1 }
    },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-2 PAYLOAD {\"order_id\":2,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-3 PAYLOAD {\"order_id\":3,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-4 PAYLOAD {\"order_id\":4,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-5 PAYLOAD {\"order_id\":5,\"status\":\"pending\"}",
      "STORE order_created FOR customer-6 PAYLOAD {\"order_id\":6,\"status\":\"pending\"}",
      "STORE order_created FOR customer-7 PAYLOAD {\"order_id\":7,\"status\":\"confirmed\"}",
      "SLEEP 1000",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "customer-1",
        "customer-2",
        "customer-3",
        "customer-4",
        "customer-7"
      ]
    }
  },
  {
    "name": "multi_context_query",
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR user-1 PAYLOAD {\"device\":\"android\"} ",
      "STORE login FOR user-2 PAYLOAD {\"device\":\"android\"} ",
      "STORE login FOR user-3 PAYLOAD {\"device\":\"web\"} ",
      "STORE login FOR user-4 PAYLOAD {\"device\":\"android\"} ",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-1",
        "user-2",
        "user-4"
      ]
    }
  },
  {
    "name": "replay_from_segment",
    "input_commands": [
      "DEFINE order_shipped FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":999,\"status\":\"shipped\"}",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":1000,\"status\":\"delivered\"}",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":1001,\"status\":\"delivered\"}",
      "STORE order_shipped FOR customer-100 PAYLOAD {\"order_id\":1002,\"status\":\"returned\"}",
      "FLUSH",
      "REPLAY order_shipped FOR customer-99"
    ],
    "matchers": [
      {
      "kind": "include_all",
      "value": [
        "\"order_id\":999",
        "\"order_id\":1000",
        "\"order_id\":1001"
      ]
    },
    {
      "kind": "include_none",
      "value": [
        "1002"
      ]
    }
    ]
  },
  {
    "name": "replay_mixed_context",
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR alice PAYLOAD {\"device\":\"android\"}",
      "STORE login FOR alice PAYLOAD {\"device\":\"web\"}",
      "STORE login FOR bob PAYLOAD {\"device\":\"iphone\"}",
      "REPLAY FOR alice"
    ],
    "matchers": [
      {
      "kind": "include_all",
      "value": [
        "android",
        "web"
      ]
    },
    {
      "kind": "include_none",
      "value": [
        "bob"
      ]
    }
    ]
  },
  {
    "name": "query_on_boolean_flag",
    "input_commands": [
      "DEFINE review FIELDS { \"rating\": \"int\", \"verified\": \"bool\" }",
      "STORE review FOR u1 PAYLOAD {\"rating\":5,\"verified\":true}",
      "STORE review FOR u2 PAYLOAD {\"rating\":4,\"verified\":false}",
      "QUERY review WHERE verified=true"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "query_in_memory_only",
    "input_commands": [
      "DEFINE cart_updated FIELDS { \"sku\": \"string\", \"qty\": \"int\" }",
      "STORE cart_updated FOR user-1 PAYLOAD {\"sku\":\"ABC123\",\"qty\":2}",
      "QUERY cart_updated WHERE sku=\"ABC123\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ABC123"
        ]
      }
    ]
  },
  {
    "name": "replay_nonexistent_context",
    "input_commands": [
      "REPLAY FOR ghost-user"
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  },
  {
    "name": "replay_context_post_flush",
    "input_commands": [
      "DEFINE order_returned FIELDS { \"order_id\": \"int\", \"reason\": \"string\" }",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":991,\"reason\":\"broken\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":992,\"reason\":\"wrong_size\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":993,\"reason\":\"changed_mind\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":994,\"reason\":\"late_delivery\"}",
      "FLUSH",
      "REPLAY order_returned FOR user-2"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "991",
        "992",
        "993",
        "994"
      ]
    }
  },
  {
    "name": "query_empty_event_type",
    "input_commands": [
      "QUERY nonexistent_type WHERE id=42"
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  },
  {
    "name": "query_filter_single_match",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-1 PAYLOAD {\"id\":1,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-1"
      ]
    }
  },
  {
    "name": "query_with_no_match",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-2 PAYLOAD {\"id\":2,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  },
  {
    "name": "query_multiple_matches",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-3 PAYLOAD {\"id\":3,\"country\":\"NL\"} ",
      "STORE order_created FOR user-4 PAYLOAD {\"id\":4,\"country\":\"NL\"} ",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-3",
        "user-4"
      ]
    }
  },
  {
    "name": "query_multiple_shards",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-7 PAYLOAD {\"id\":7,\"country\":\"NL\"}",
      "STORE order_created FOR user-8 PAYLOAD {\"id\":8,\"country\":\"DE\"}",
      "STORE order_created FOR user-9 PAYLOAD {\"id\":9,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-7",
        "user-9"
      ]
    }
  },
  {
    "name": "query_mixed_conditions",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-10 PAYLOAD {\"id\":10,\"country\":\"NL\"}",
      "STORE order_created FOR user-11 PAYLOAD {\"id\":11,\"country\":\"FR\"}",
      "STORE order_created FOR user-12 PAYLOAD {\"id\":12,\"country\":\"FR\"}",
      "QUERY order_created WHERE country=\"FR\" AND id > 11"
    ],
    "matchers": [
      {
      "kind": "include_all",
      "value": [
        "user-12"
      ]
    },
    {
      "kind": "include_none",
      "value": [
        "user-10",
        "user-11"
      ]
    }
    ]
  },
  {
    "name": "query_after_multiple_flushes",
    "input_commands": [
      "DEFINE order_create_1 FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_create_1 FOR user-12 PAYLOAD {\"id\":12,\"country\":\"DE\"}",
      "FLUSH",
      "STORE order_create_1 FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_create_1 WHERE country=NL"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-12"
        ]
      }
    ]
  },
  {
    "name": "query_with_inequality",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "QUERY order_created WHERE country!=\"NL\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ]
  },
  {
    "name": "query_with_not",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "QUERY order_created WHERE NOT country=\"NL\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ]
  },
  {
    "name": "query_with_or",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE country=\"NL\" OR country=\"FR\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13",
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-15"
        ]
      }
    ]
  },
  {
    "name": "query_with_greater_than_or_equal",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE id >= 14"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14",
          "user-15"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ]
  },
  {
    "name": "query_with_less_than_or_equal",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE id <= 14"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13",
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-15"
        ]
      }
    ]
  },
  {
    "name": "query_with_logical_operators",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY order_created WHERE id > 13 AND id < 15"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_limit_zero_no_results",
    "input_commands": [
      "DEFINE limit_zero FIELDS { \"status\": \"string\" }",
      "STORE limit_zero FOR a PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_zero FOR b PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_zero WHERE status=\"ok\" LIMIT 0"
    ],
    "matcher": { "kind": "include", "value": "No matching events found" }
  }
  ,
  {
    "name": "query_limit_memtable_only_two",
    "config": { "engine": { "fill_factor": 100 } },
    "input_commands": [
      "DEFINE limit_mem_only FIELDS { \"status\": \"string\" }",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_mem_only FOR u2 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_mem_only FOR u3 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_mem_only WHERE status=\"ok\" LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u2","u3"] },
      { "kind": "include_none", "value": ["u1"] }
    ]
  }
  ,
  {
    "name": "query_limit_memtable_only_two_same_shard",
    "config": { "engine": { "fill_factor": 100 } },
    "input_commands": [
      "DEFINE limit_mem_only FIELDS { \"status\": \"int\" }",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":400}",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":500}",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":200}",
      "QUERY limit_mem_only LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"status\":400","\"status\":500"] },
      { "kind": "include_none", "value": ["\"status\":200"] }
    ]
  }
  ,
  {
    "name": "query_limit_combines_memtable_and_segment",
    "input_commands": [
      "DEFINE limit_mix FIELDS { \"status\": \"string\" }",
      "STORE limit_mix FOR seg-ctx PAYLOAD {\"status\":\"ok\"}",
      "FLUSH",
      "STORE limit_mix FOR mem-ctx PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_mix WHERE status=\"ok\" LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["seg-ctx","mem-ctx"] }
    ]
  }
  ,
  {
    "name": "query_limit_equal_to_total",
    "config": { "engine": { "fill_factor": 100 } },
    "input_commands": [
      "DEFINE limit_eq_total FIELDS { \"status\": \"string\" }",
      "STORE limit_eq_total FOR c1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_eq_total FOR c2 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_eq_total FOR c3 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_eq_total WHERE status=\"ok\" LIMIT 3"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["c1","c2","c3"] }
    ]
  }
  ,
  {
    "name": "query_limit_greater_than_total",
    "config": { "engine": { "fill_factor": 100 } },
    "input_commands": [
      "DEFINE limit_gt_total FIELDS { \"status\": \"string\" }",
      "STORE limit_gt_total FOR d1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_gt_total FOR d2 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_gt_total WHERE status=\"ok\" LIMIT 10"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["d1","d2"] }
    ]
  }
  ,
  {
    "name": "replay_since_using_created_at_iso8601",
    "input_commands": [
      "DEFINE evt_rp1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp1 FOR rctx PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp1 FOR rctx PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp1 FOR rctx SINCE \"2025-01-01T00:00:01Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "replay_since_using_created_at_ms",
    "input_commands": [
      "DEFINE evt_rp2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp2 FOR rctx2 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp2 FOR rctx2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp2 FOR rctx2 SINCE \"1735689600000\" USING created_at"
    ],
    "matcher": { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
  }
  ,
  {
    "name": "replay_since_using_date_field_midnight",
    "input_commands": [
      "DEFINE evt_rp3 FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE evt_rp3 FOR rctx3 PAYLOAD {\"id\":1,\"on\":\"2025-01-01\"}",
      "STORE evt_rp3 FOR rctx3 PAYLOAD {\"id\":2,\"on\":\"2025-01-02\"}",
      "FLUSH",
      "REPLAY evt_rp3 FOR rctx3 SINCE \"2025-01-02T00:00:00Z\" USING on"
    ],
    "matcher": { "kind": "include", "value": "\"id\":2" }
  }
  ,
  {
    "name": "replay_since_unparsable_ignored",
    "input_commands": [
      "DEFINE evt_rp4 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp4 FOR rctx4 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp4 FOR rctx4 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp4 FOR rctx4 SINCE \"bogus\" USING created_at"
    ],
    "matcher": { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
  },
  {
    "name": "bucket_month_using_created_at_boundary",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders_time FIELDS { \"id\": \"int\", \"created_at\": \"datetime\", \"amount\": \"int\" }",
      "STORE orders_time FOR b1 PAYLOAD {\"id\":1,\"created_at\":1736639999,\"amount\":10}",
      "STORE orders_time FOR b2 PAYLOAD {\"id\":2,\"created_at\":1736640000,\"amount\":20}",
      "FLUSH",
      "QUERY orders_time TOTAL amount PER month USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"bucket\"" },
      { "kind": "include_all", "value": ["1735689600","1735689600"] },
      { "kind": "include_all", "value": ["30"] }
    ]
  }
  ,
  {
    "name": "bucket_week_using_created_at_negative_offset_cross_week",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE sessions FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE sessions FOR s1 PAYLOAD {\"id\":1,\"created_at\":1735171199}",
      "STORE sessions FOR s2 PAYLOAD {\"id\":2,\"created_at\":1735171200}",
      "FLUSH",
      "QUERY sessions COUNT PER week USING created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["[1734912000,2]"] }
    ]
  }
  ,
  {
    "name": "bucket_day_using_date_field_midnight_normalization",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE birthdays FIELDS { \"id\": \"int\", \"birthdate\": \"date\" }",
      "STORE birthdays FOR bd1 PAYLOAD {\"id\":1,\"birthdate\":\"2025-09-06\"}",
      "STORE birthdays FOR bd2 PAYLOAD {\"id\":2,\"birthdate\":\"2025-09-06\"}",
      "STORE birthdays FOR bd3 PAYLOAD {\"id\":3,\"birthdate\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY birthdays COUNT PER day USING birthdate"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count\"" },
      { "kind": "include", "value": "2" },
      { "kind": "include", "value": "1" }
    ]
  }
  ,
  {
    "name": "bucket_hour_using_created_at_ms_payload",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE clicks FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE clicks FOR c1 PAYLOAD {\"id\":1,\"created_at\":1735689600000}",
      "STORE clicks FOR c2 PAYLOAD {\"id\":2,\"created_at\":1735693199000}",
      "STORE clicks FOR c3 PAYLOAD {\"id\":3,\"created_at\":1735693200000}",
      "FLUSH",
      "QUERY clicks COUNT PER hour USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count\"" },
      { "kind": "include", "value": "2" },
      { "kind": "include", "value": "1" }
    ]
  },
  {
    "name": "since_using_created_at_equal_boundary_included",
    "input_commands": [
      "DEFINE evt_eq FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_eq FOR ctxEq PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T23:59:59Z\"}",
      "STORE evt_eq FOR ctxEq PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_eq FOR ctxEq SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "since_using_created_at_ms_input",
    "input_commands": [
      "DEFINE evt_ms FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_ms FOR ctxMs PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_ms FOR ctxMs PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_ms FOR ctxMs SINCE \"1735689600000\" USING created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
    ]
  }
  ,
  {
    "name": "since_using_created_at_ns_input_excludes_first",
    "input_commands": [
      "DEFINE evt_ns FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_ns FOR ctxNs PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_ns FOR ctxNs PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_ns FOR ctxNs SINCE \"1735689601000000000\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "since_using_created_at_minus_offset_boundary",
    "input_commands": [
      "DEFINE evt_neg_off FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_neg_off FOR ctxNo PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T18:59:59-05:00\"}",
      "STORE evt_neg_off FOR ctxNo PAYLOAD {\"id\":2,\"created_at\":\"2024-12-31T19:00:00-05:00\"}",
      "FLUSH",
      "QUERY evt_neg_off FOR ctxNo SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "store_created_at_ms_number_normalized",
    "input_commands": [
      "DEFINE evt_store_ms FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_store_ms FOR ctxSm PAYLOAD {\"id\":1,\"created_at\":1735689600000}",
      "STORE evt_store_ms FOR ctxSm PAYLOAD {\"id\":2,\"created_at\":1735689601000}",
      "FLUSH",
      "QUERY evt_store_ms FOR ctxSm SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
    ]
  },
  {
    "name": "since_using_created_at_with_offset",
    "input_commands": [
      "DEFINE evt_off FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_off FOR ctxO PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T01:59:59+02:00\"}",
      "STORE evt_off FOR ctxO PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T02:00:01+02:00\"}",
      "FLUSH",
      "QUERY evt_off FOR ctxO SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "since_using_date_field",
    "input_commands": [
      "DEFINE people FIELDS { \"id\": \"int\", \"birthdate\": \"date\" }",
      "STORE people FOR pctx PAYLOAD {\"id\":1,\"birthdate\":\"2025-09-06\"}",
      "STORE people FOR pctx PAYLOAD {\"id\":2,\"birthdate\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY people FOR pctx SINCE \"2025-09-07T00:00:00Z\" USING birthdate"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "store_invalid_time_string_rejected",
    "input_commands": [
      "DEFINE evt_bad_time FIELDS { \"created_at\": \"datetime\" }",
      "STORE evt_bad_time FOR ctxBad PAYLOAD {\"created_at\":\"not-a-time\"}"
    ],
    "matcher": { "kind": "include", "value": "Invalid time string" }
  }
  ,
  {
    "name": "since_unparsable_ignored_includes_all",
    "input_commands": [
      "DEFINE evt_bogus FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_bogus FOR ctxBog PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "STORE evt_bogus FOR ctxBog PAYLOAD {\"id\":2,\"created_at\":\"2025-01-02T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_bogus FOR ctxBog SINCE \"bogus\" USING created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
    ]
  }
  ,
  {
    "name": "since_using_optional_datetime_skips_nulls",
    "input_commands": [
      "DEFINE evt_opt_time FIELDS { \"id\": \"int\", \"created_at\": \"datetime | null\" }",
      "STORE evt_opt_time FOR ctxOpt PAYLOAD {\"id\":1,\"created_at\":null}",
      "STORE evt_opt_time FOR ctxOpt PAYLOAD {\"id\":2,\"created_at\":\"2025-01-02T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_opt_time FOR ctxOpt SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  },
  {
    "name": "since_using_created_at_iso8601_selection",
    "input_commands": [
      "DEFINE evt_time_sel1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_time_sel1 FOR ctxA PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T23:59:59Z\"}",
      "STORE evt_time_sel1 FOR ctxA PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_time_sel1 FOR ctxA SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":2" },
      { "kind": "include_none", "value": ["\"id\":1"] }
    ]
  }
  ,
  {
    "name": "since_using_created_at_numeric_units_selection",
    "input_commands": [
      "DEFINE evt_time_sel2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_time_sel2 FOR ctxB PAYLOAD {\"id\":1,\"created_at\":1600000000000}",
      "STORE evt_time_sel2 FOR ctxB PAYLOAD {\"id\":2,\"created_at\":1600000100000}",
      "FLUSH",
      "QUERY evt_time_sel2 FOR ctxB SINCE \"1600000000\" USING created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"id\":1","\"id\":2"] }
    ]
  }
  ,
  {
    "name": "agg_count_per_day_by_country_and_plan",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\", \"plan\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\",\"plan\":\"pro\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"NL\",\"plan\":\"basic\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"DE\",\"plan\":\"pro\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":18,\"country\":\"NL\",\"plan\":\"pro\"}",
      "STORE orders FOR c5 PAYLOAD {\"amount\":11,\"country\":\"NL\",\"plan\":\"basic\"}",
      "FLUSH",
      "QUERY orders COUNT PER day BY country, plan"
    ],
    "matchers": [
      { "kind": "include", "value": "\"NL\",\"basic\",2" },
      { "kind": "include", "value": "\"NL\",\"pro\",2" },
      { "kind": "include", "value": "\"DE\",\"pro\",1" }
    ]
  }
  ,
  {
    "name": "agg_count_unique_user_by_country_per_week",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id PER week BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count_unique_user_id\"" },
      { "kind": "include", "value": "\"NL\",1" },
      { "kind": "include", "value": "\"DE\",1" }
    ]
  }
  ,
  {
    "name": "agg_avg_min_max_with_filter_by_country",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\", \"status\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\",\"status\":\"ok\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":30,\"country\":\"NL\",\"status\":\"ok\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":25,\"country\":\"DE\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY orders WHERE status=\"ok\" AVG amount, MIN amount, MAX amount BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"avg_amount\"" },
      { "kind": "include", "value": "\"min_amount\"" },
      { "kind": "include", "value": "\"max_amount\"" },
      { "kind": "include", "value": "\"NL\"" },
      { "kind": "include", "value": "20.0" },
      { "kind": "include", "value": "10" },
      { "kind": "include", "value": "30" }
    ]
  }
  ,
  {
    "name": "agg_total_amount_group_by_two_fields_no_bucket",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"region\": \"string\", \"channel\": \"string\" }",
      "STORE orders FOR r1 PAYLOAD {\"amount\":5,\"region\":\"EU\",\"channel\":\"web\"}",
      "STORE orders FOR r2 PAYLOAD {\"amount\":7,\"region\":\"EU\",\"channel\":\"store\"}",
      "STORE orders FOR r3 PAYLOAD {\"amount\":9,\"region\":\"US\",\"channel\":\"web\"}",
      "FLUSH",
      "QUERY orders TOTAL amount BY region, channel"
    ],
    "matchers": [
      { "kind": "include", "value": "\"EU\",\"web\",5" },
      { "kind": "include", "value": "\"EU\",\"store\",7" },
      { "kind": "include", "value": "\"US\",\"web\",9" }
    ]
  }
  ,
  {
    "name": "agg_count_and_avg_per_hour_by_region",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE metrics FIELDS { \"value\": \"int\", \"region\": \"string\" }",
      "STORE metrics FOR m1 PAYLOAD {\"value\":1,\"region\":\"EU\"}",
      "STORE metrics FOR m2 PAYLOAD {\"value\":3,\"region\":\"EU\"}",
      "STORE metrics FOR m3 PAYLOAD {\"value\":2,\"region\":\"US\"}",
      "FLUSH",
      "QUERY metrics COUNT, AVG value PER hour BY region"
    ],
    "matchers": [
      { "kind": "include", "value": "\"EU\",2,2.0" },
      { "kind": "include", "value": "\"US\",1,2.0" }
    ]
  }
  ,
  {
    "name": "agg_count_and_count_unique_by_country",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR a PAYLOAD {\"user_id\":\"X\",\"country\":\"NL\"}",
      "STORE login FOR b PAYLOAD {\"user_id\":\"Y\",\"country\":\"NL\"}",
      "STORE login FOR c PAYLOAD {\"user_id\":\"X\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT, COUNT UNIQUE user_id BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count\"" },
      { "kind": "include", "value": "\"count_unique_user_id\"" },
      { "kind": "include", "value": "\"NL\",3,2" }
    ]
  },
  {
    "name": "agg_count_all_simple",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "STORE evt FOR b PAYLOAD {\"v\":2}",
      "FLUSH",
      "QUERY evt COUNT"
    ],
    "matcher": { "kind": "include", "value": "\"rows\":[[2]]" }
  }
  ,
  {
    "name": "agg_count_unique_by_country",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count_unique_user_id\"" },
      { "kind": "include", "value": "\"NL\",1" },
      { "kind": "include", "value": "\"DE\",1" }
    ]
  }
  ,
  {
    "name": "agg_count_by_country",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT user_id BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"count_user_id\"" },
      { "kind": "include", "value": "\"NL\",2" },
      { "kind": "include", "value": "\"DE\",1" }
    ]
  }
  ,
  {
    "name": "agg_avg_total_min_max_per_month_by_country",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"NL\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders AVG amount, TOTAL amount, MIN amount, MAX amount PER month BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"DE\",15.0,15,15,15" },
      { "kind": "include", "value": "\"NL\",15.0,30,10,20" }
    ]
  }
  ,
  {
    "name": "agg_multiple_ops_no_group",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE evt FIELDS { \"x\": \"int\", \"y\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"x\":1,\"y\":2}",
      "STORE evt FOR b PAYLOAD {\"x\":3,\"y\":4}",
      "FLUSH",
      "QUERY evt AVG x, MIN y, MAX y, TOTAL x"
    ],
    "matchers": [
      { "kind": "include", "value": "\"rows\":[[2.0,2,4,4]]" }
    ]
  }
  ,
  {
    "name": "agg_count_only_with_filter",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE evt FIELDS { \"kind\": \"string\" }",
      "STORE evt FOR k1 PAYLOAD {\"kind\":\"a\"}",
      "STORE evt FOR k2 PAYLOAD {\"kind\":\"b\"}",
      "STORE evt FOR k3 PAYLOAD {\"kind\":\"a\"}",
      "FLUSH",
      "QUERY evt WHERE kind=\"a\" COUNT"
    ],
    "matcher": { "kind": "include", "value": "\"rows\":[[2]]" }
  },
  {
    "name": "agg_scalar_avg_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":30}",
      "FLUSH",
      "QUERY orders AVG amount"
    ],
    "matcher": { "kind": "include", "value": "[[20.0]]" }
  },
  {
    "name": "agg_scalar_total_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":30}",
      "FLUSH",
      "QUERY orders TOTAL amount"
    ],
    "matcher": { "kind": "include", "value": "[[60]]" }
  },
  {
    "name": "agg_scalar_min_max_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":30}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":20}",
      "FLUSH",
      "QUERY orders MIN amount, MAX amount"
    ],
    "matchers": [
      { "kind": "include", "value": "[10,30]" }
    ]
  },
  {
    "name": "agg_count_with_limit_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"FR\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"FR\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":25,\"country\":\"IT\"}",
      "FLUSH",
      "QUERY orders COUNT BY country ORDER BY country DESC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include", "value": "[\"NL\",1],[\"IT\",1]" }
    ]
  },
  {
    "name": "agg_avg_merging_accuracy_streaming",
    "config": { "query": { "streaming_enabled": true }, "engine": { "shard_count": 2 } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"category\": \"string\" }",
      "STORE orders FOR shard1-c1 PAYLOAD {\"amount\":10,\"category\":\"A\"}",
      "STORE orders FOR shard1-c2 PAYLOAD {\"amount\":20,\"category\":\"A\"}",
      "FLUSH",
      "STORE orders FOR shard2-c3 PAYLOAD {\"amount\":30,\"category\":\"A\"}",
      "FLUSH",
      "QUERY orders AVG amount BY category"
    ],
    "matchers": [
      { "kind": "include", "value": "[[\"A\",20.0]]" }
    ]
  },
  {
    "name": "agg_count_unique_merging_accuracy_streaming",
    "config": { "query": { "streaming_enabled": true }, "engine": { "shard_count": 2 } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"region\": \"string\" }",
      "STORE login FOR shard1-r1 PAYLOAD {\"user_id\":\"user1\",\"region\":\"EU\"}",
      "STORE login FOR shard1-r2 PAYLOAD {\"user_id\":\"user2\",\"region\":\"EU\"}",
      "FLUSH",
      "STORE login FOR shard2-r3 PAYLOAD {\"user_id\":\"user1\",\"region\":\"EU\"}",
      "STORE login FOR shard2-r4 PAYLOAD {\"user_id\":\"user3\",\"region\":\"EU\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id BY region"
    ],
    "matchers": [
      { "kind": "include", "value": "[[\"EU\",3]]" }
    ]
  },
  {
    "name": "agg_scalar_count_unique_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id"
    ],
    "matcher": { "kind": "include", "value": "[[2]]" }
  },
  {
    "name": "agg_multiple_ops_with_limit_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"DE\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"IT\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":25,\"country\":\"IT\"}",
      "FLUSH",
      "QUERY orders AVG amount, TOTAL amount BY country ORDER BY country DESC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include", "value": "[[\"NL\",10.0,10],[\"IT\",20.0,40]]" }
    ]
  },
  {
    "name": "agg_empty_groups_filtered_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders COUNT BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "[\"NL\",1]" },
      { "kind": "include", "value": "[\"DE\",1]" }
    ]
  },
  {
    "name": "agg_count_field_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int | null\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"order_id\":1,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"order_id\":2,\"country\":\"NL\"}",
      "STORE orders FOR c3 PAYLOAD {\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders COUNT order_id BY country"
    ],
    "matchers": [
      { "kind": "include", "value": "\"NL\",2" }
    ]
  },
  {
    "name": "agg_all_operations_comprehensive_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE metrics FIELDS { \"value\": \"int\", \"user_id\": \"string\", \"category\": \"string\" }",
      "STORE metrics FOR m1 PAYLOAD {\"value\":10,\"user_id\":\"A\",\"category\":\"X\"}",
      "STORE metrics FOR m2 PAYLOAD {\"value\":20,\"user_id\":\"B\",\"category\":\"X\"}",
      "STORE metrics FOR m3 PAYLOAD {\"value\":15,\"user_id\":\"A\",\"category\":\"Y\"}",
      "STORE metrics FOR m4 PAYLOAD {\"value\":25,\"user_id\":\"C\",\"category\":\"X\"}",
      "FLUSH",
      "QUERY metrics COUNT, COUNT UNIQUE user_id, AVG value, TOTAL value, MIN value, MAX value BY category"
    ],
    "matchers": [
      { "kind": "include", "value": "[[\"X\",3,3,18.333333333333332,55,10,25],[\"Y\",1,1,15.0,15,15,15]]" }
    ]
  },
  {
    "name": "enum_store_wrong_case_rejected",
    "input_commands": [
      "DEFINE plan_change FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE plan_change FOR u1 PAYLOAD {\"plan\": \"Pro\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "does not match expected type"
    }
  },
  {
    "name": "enum_query_wrong_case_returns_no_results",
    "input_commands": [
      "DEFINE plan_change FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE plan_change FOR u1 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY plan_change WHERE plan=\"Pro\""
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  },
  {
    "name": "ebm_eq_logs_pruning",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"pro\" OR plan = \"premium\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx4"
        ]
      }
    ]
  },
  {
    "name": "ebm_neq_logs_pruning",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "FLUSH",
      "QUERY subscription WHERE plan != \"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx1",
          "ctx3",
          "ctx4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx2"
        ]
      }
    ]
  },
  {
    "name": "ebm_unknown_variant_no_results",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR u1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR u2 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"unknown\""
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  },
  {
    "name": "ebm_eq_across_two_zones",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "STORE subscription FOR ctx5 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx6 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx7 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx8 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx9 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx5",
          "ctx7",
          "ctx9"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx3",
          "ctx4",
          "ctx6",
          "ctx8"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_hits_memtable_only",
    "config": {
      "engine": { "fill_factor": 100 }
    },
    "input_commands": [
      "DEFINE hot_path FIELDS { \"device\": \"string\" }",
      "STORE hot_path FOR u1 PAYLOAD {\"device\":\"android\"}",
      "STORE hot_path FOR u2 PAYLOAD {\"device\":\"iphone\"}",
      "STORE hot_path FOR u3 PAYLOAD {\"device\":\"android\"}",
      "QUERY hot_path WHERE device=\"android\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_hits_passive_memtable",
    "config": {
      "engine": { "fill_factor": 1 }
    },
    "input_commands": [
      "DEFINE warm_path FIELDS { \"device\": \"string\" }",
      "STORE warm_path FOR u1 PAYLOAD {\"device\":\"android\"}",
      "QUERY warm_path WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "u1"
      ]
    }
  },
  {
    "name": "wal_reload_after_restart",
  "config": { "engine": { "fill_factor": 100 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": { "kind": "include_all", "value": ["u1"] }
  }
  ,
  {
    "name": "wal_recover_no_flush",
  "config": { "engine": { "fill_factor": 100 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": { "kind": "include_all", "value": ["u1"] }
  }
  ,
  {
    "name": "wal_disabled_no_recovery",
  "config": { "engine": { "fill_factor": 100 }, "wal": { "enabled": false} },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": { "kind": "include", "value": "No matching events found" }
  }
  ,
  {
    "name": "wal_multi_log_recovery",
  "config": { "engine": { "fill_factor": 2 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "STORE evt FOR b PAYLOAD {\"v\":2}",
      "STORE evt FOR c PAYLOAD {\"v\":3}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY evt WHERE v>=1"
    ],
    "matcher": { "kind": "include_all", "value": ["a","b","c"] }
  }
  ,
  {
    "name": "wal_recover_during_pending_flush",
  "config": { "engine": { "fill_factor": 1 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY evt WHERE v=1"
    ],
    "matcher": { "kind": "include_all", "value": ["a"] }
  }
  ,
  {
    "name": "wal_flush_then_restart_segment_only",
  "config": { "engine": { "fill_factor": 2 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE order FIELDS { \"id\": \"int\" }",
      "STORE order FOR c1 PAYLOAD {\"id\":1}",
      "STORE order FOR c2 PAYLOAD {\"id\":2}",
      "SLEEP 200",
      "RESTART",
      "SLEEP 200",
      "QUERY order WHERE id>=1"
    ],
    "matcher": { "kind": "include_all", "value": ["c1","c2"] }
  }
  ,
  {
    "name": "wal_recover_multi_shard",
  "config": { "engine": { "fill_factor": 100, "shard_count": 2 }, "wal": { "enabled": true } },
    "input_commands": [
      "DEFINE ping FIELDS { \"x\": \"int\" }",
      "STORE ping FOR shard-a PAYLOAD {\"x\":1}",
      "STORE ping FOR shard-b PAYLOAD {\"x\":2}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY ping WHERE x>=1"
    ],
    "matcher": { "kind": "include_all", "value": ["shard-a","shard-b"] }
  }
  ,
  {
    "name": "wal_durable_flush_each_write",
    "config": {
      "engine": { "fill_factor": 100 },
      "wal": { "enabled": true, "buffered": true, "flush_each_write": true, "fsync": false }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 10",
      "RESTART",
      "SLEEP 10",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": { "kind": "include_all", "value": ["u1"] }
  }
  ,
  {
    "name": "wal_fsync_every_n_without_flush_each_write",
    "config": {
      "engine": { "fill_factor": 100 },
      "wal": { "enabled": true, "buffered": true, "flush_each_write": false, "fsync": true, "fsync_every_n": 1 }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR u1 PAYLOAD {\"v\":1}",
      "SLEEP 10",
      "RESTART",
      "SLEEP 10",
      "QUERY evt WHERE v=1"
    ],
    "matcher": { "kind": "include", "value": "No matching events found" }
  }
  ,
  {
    "name": "order_by_with_lt_small_limit",
    "input_commands": [
      "DEFINE small_lt FIELDS { \"id\": \"int\" }",
      "STORE small_lt FOR a PAYLOAD {\"id\":0}",
      "STORE small_lt FOR b PAYLOAD {\"id\":1}",
      "STORE small_lt FOR c PAYLOAD {\"id\":2}",
      "FLUSH",
      "QUERY small_lt WHERE id < 10 ORDER BY id ASC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"id\":0", "\"id\":1"] },
      { "kind": "include_none", "value": ["\"id\":2"] }
    ]
  },
  {
    "name": "order_by_desc_with_gt_bound",
    "input_commands": [
      "DEFINE big_gt FIELDS { \"v\": \"int\" }",
      "STORE big_gt FOR g1 PAYLOAD {\"v\":100}",
      "STORE big_gt FOR g2 PAYLOAD {\"v\":200}",
      "STORE big_gt FOR g3 PAYLOAD {\"v\":300}",
      "FLUSH",
      "QUERY big_gt WHERE v > 150 ORDER BY v DESC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"v\":300", "\"v\":200"] },
      { "kind": "include_none", "value": ["\"v\":100"] }
    ]
  },
  {
    "name": "order_by_asc_frontier_min",
    "input_commands": [
      "DEFINE frontier FIELDS { \"score\": \"int\" }",
      "STORE frontier FOR x1 PAYLOAD {\"score\":100000}",
      "STORE frontier FOR x2 PAYLOAD {\"score\":200000}",
      "STORE frontier FOR x3 PAYLOAD {\"score\":300000}",
      "FLUSH",
      "QUERY frontier ORDER BY score ASC LIMIT 1"
    ],
    "matcher": { "kind": "include", "value": "\"score\":100000" }
  },
  {
    "name": "query_order_by_asc_with_limit",
    "input_commands": [
      "DEFINE score FIELDS { \"val\": \"int\" }",
      "STORE score FOR u1 PAYLOAD {\"val\":50}",
      "STORE score FOR u2 PAYLOAD {\"val\":30}",
      "STORE score FOR u3 PAYLOAD {\"val\":70}",
      "STORE score FOR u4 PAYLOAD {\"val\":10}",
      "STORE score FOR u5 PAYLOAD {\"val\":90}",
      "FLUSH",
      "QUERY score ORDER BY val ASC LIMIT 3"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":10", "\"val\":30", "\"val\":50"] },
      { "kind": "include_none", "value": ["\"val\":70", "\"val\":90"] }
    ]
  }
  ,
  {
    "name": "query_order_by_desc_with_limit",
    "input_commands": [
      "DEFINE score FIELDS { \"val\": \"int\" }",
      "STORE score FOR u1 PAYLOAD {\"val\":50}",
      "STORE score FOR u2 PAYLOAD {\"val\":30}",
      "STORE score FOR u3 PAYLOAD {\"val\":70}",
      "STORE score FOR u4 PAYLOAD {\"val\":10}",
      "STORE score FOR u5 PAYLOAD {\"val\":90}",
      "FLUSH",
      "QUERY score ORDER BY val DESC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":90", "\"val\":70"] },
      { "kind": "include_none", "value": ["\"val\":50", "\"val\":30", "\"val\":10"] }
    ]
  }
  ,
  {
    "name": "query_created_at_eq_iso8601",
    "input_commands": [
      "DEFINE evt_q1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q1 FOR ctx1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_q1 FOR ctx2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "SLEEP 500",
      "QUERY evt_q1 WHERE created_at=\"2025-01-01T00:00:01Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["ctx2"] }
  }
  ,
  {
    "name": "query_created_at_gt_seconds",
    "input_commands": [
      "DEFINE evt_q2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q2 FOR cta PAYLOAD {\"id\":1,\"created_at\":1735689600}",
      "STORE evt_q2 FOR ctb PAYLOAD {\"id\":2,\"created_at\":1735689601}",
      "FLUSH",
      "QUERY evt_q2 WHERE created_at > 1735689600"
    ],
    "matcher": { "kind": "include_all", "value": ["ctb"] }
  }
  ,
  {
    "name": "query_created_at_invalid_string_no_results",
    "input_commands": [
      "DEFINE evt_q3 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q3 FOR cix PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_q3 WHERE created_at=\"not-a-time\""
    ],
    "matcher": { "kind": "include", "value": "No matching events found" }
  }
  ,
  {
    "name": "query_date_field_eq_midnight",
    "input_commands": [
      "DEFINE people_q FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE people_q FOR pqa PAYLOAD {\"id\":1,\"on\":\"2025-09-06\"}",
      "STORE people_q FOR pqb PAYLOAD {\"id\":2,\"on\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY people_q WHERE on=\"2025-09-06T00:00:00Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["pqa"] }
  }
  ,
  {
    "name": "query_order_by_with_offset_and_limit",
    "input_commands": [
      "DEFINE price FIELDS { \"val\": \"int\" }",
      "STORE price FOR p1 PAYLOAD {\"val\":100}",
      "STORE price FOR p2 PAYLOAD {\"val\":200}",
      "STORE price FOR p3 PAYLOAD {\"val\":300}",
      "STORE price FOR p4 PAYLOAD {\"val\":400}",
      "STORE price FOR p5 PAYLOAD {\"val\":500}",
      "FLUSH",
      "QUERY price ORDER BY val ASC OFFSET 1 LIMIT 3"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":200", "\"val\":300", "\"val\":400"] },
      { "kind": "include_none", "value": ["\"val\":100", "\"val\":500"] }
    ]
  }
  ,
  {
    "name": "query_order_by_desc_with_offset",
    "input_commands": [
      "DEFINE rating FIELDS { \"val\": \"int\" }",
      "STORE rating FOR r1 PAYLOAD {\"val\":5}",
      "STORE rating FOR r2 PAYLOAD {\"val\":10}",
      "STORE rating FOR r3 PAYLOAD {\"val\":15}",
      "STORE rating FOR r4 PAYLOAD {\"val\":20}",
      "STORE rating FOR r5 PAYLOAD {\"val\":25}",
      "FLUSH",
      "QUERY rating ORDER BY val DESC OFFSET 2 LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":15", "\"val\":10"] },
      { "kind": "include_none", "value": ["\"val\":25", "\"val\":20", "\"val\":5"] }
    ]
  }
  ,
  {
    "name": "query_offset_without_limit_rejected",
    "input_commands": [
      "DEFINE evt FIELDS { \"val\": \"int\" }",
      "STORE evt FOR e1 PAYLOAD {\"val\":1}",
      "STORE evt FOR e2 PAYLOAD {\"val\":2}",
      "FLUSH",
      "QUERY evt ORDER BY val ASC OFFSET 1"
    ],
    "matcher": { "kind": "include", "value": "OFFSET requires LIMIT" }
  }
  ,
  {
    "name": "query_order_by_string_field_asc",
    "input_commands": [
      "DEFINE user FIELDS { \"name\": \"string\" }",
      "STORE user FOR u1 PAYLOAD {\"name\":\"charlie\"}",
      "STORE user FOR u2 PAYLOAD {\"name\":\"alice\"}",
      "STORE user FOR u3 PAYLOAD {\"name\":\"bob\"}",
      "FLUSH",
      "QUERY user ORDER BY name ASC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["alice", "bob"] },
      { "kind": "include_none", "value": ["charlie"] }
    ]
  }
  ,
  {
    "name": "query_order_by_with_filter",
    "input_commands": [
      "DEFINE item FIELDS { \"category\": \"string\", \"price\": \"int\" }",
      "STORE item FOR i1 PAYLOAD {\"category\":\"A\",\"price\":100}",
      "STORE item FOR i2 PAYLOAD {\"category\":\"A\",\"price\":200}",
      "STORE item FOR i3 PAYLOAD {\"category\":\"B\",\"price\":150}",
      "STORE item FOR i4 PAYLOAD {\"category\":\"A\",\"price\":50}",
      "FLUSH",
      "SLEEP 400",
      "QUERY item WHERE category=\"A\" ORDER BY price ASC LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"price\":50", "\"price\":100"] },
      { "kind": "include_none", "value": ["\"price\":200", "\"price\":150"] }
    ]
  }
  ,
  {
    "name": "query_order_by_offset_boundary",
    "input_commands": [
      "DEFINE num FIELDS { \"val\": \"int\" }",
      "STORE num FOR n1 PAYLOAD {\"val\":1}",
      "STORE num FOR n2 PAYLOAD {\"val\":2}",
      "STORE num FOR n3 PAYLOAD {\"val\":3}",
      "FLUSH",
      "QUERY num ORDER BY val ASC OFFSET 2 LIMIT 5"
    ],
    "matchers": [
      { "kind": "include", "value": "\"val\":3" },
      { "kind": "include_none", "value": ["\"val\":1", "\"val\":2"] }
    ]
  }
  ,
  {
    "name": "query_order_by_memtable_and_segment",
    "input_commands": [
      "DEFINE mixed FIELDS { \"val\": \"int\" }",
      "STORE mixed FOR m1 PAYLOAD {\"val\":10}",
      "STORE mixed FOR m2 PAYLOAD {\"val\":20}",
      "FLUSH",
      "STORE mixed FOR m3 PAYLOAD {\"val\":5}",
      "STORE mixed FOR m4 PAYLOAD {\"val\":15}",
      "QUERY mixed ORDER BY val ASC LIMIT 3"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":5", "\"val\":10", "\"val\":15"] },
      { "kind": "include_none", "value": ["\"val\":20"] }
    ]
  }
  ,

  {
    "name": "query_order_by_large_offset",
    "config": { "engine": { "fill_factor": 3 } },
    "input_commands": [
      "DEFINE large FIELDS { \"val\": \"int\" }",
      "STORE large FOR l1 PAYLOAD {\"val\":1}",
      "STORE large FOR l2 PAYLOAD {\"val\":2}",
      "STORE large FOR l3 PAYLOAD {\"val\":3}",
      "STORE large FOR l4 PAYLOAD {\"val\":4}",
      "STORE large FOR l5 PAYLOAD {\"val\":5}",
      "STORE large FOR l6 PAYLOAD {\"val\":6}",
      "FLUSH",
      "SLEEP 500",
      "QUERY large ORDER BY val ASC OFFSET 4 LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["\"val\":5", "\"val\":6"] },
      { "kind": "include_none", "value": ["\"val\":1", "\"val\":2", "\"val\":3", "\"val\":4"] }
    ]
  }
  ,
  {
    "name": "created_at_between_inclusive_and_exclusive",
    "input_commands": [
      "DEFINE evt_between_1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_between_1 FOR ba PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_between_1 FOR bb PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_between_1 WHERE created_at >= \"2025-01-01T00:00:00Z\" AND created_at < \"2025-01-01T00:00:01Z\"",
      "QUERY evt_between_1 WHERE created_at > \"2025-01-01T00:00:00Z\" AND created_at <= \"2025-01-01T00:00:01Z\""
    ],
    "matchers": [
      { "kind": "include_all", "value": ["ba"] },
      { "kind": "include_all", "value": ["bb"] }
    ]
  }
  ,
  {
    "name": "created_at_seconds_range",
    "input_commands": [
      "DEFINE evt_frac FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_frac FOR f1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_frac FOR f2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_frac WHERE created_at >= \"2025-01-01T00:00:01Z\" AND created_at < \"2025-01-01T00:00:02Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["f2"] }
  }
  ,
  {
    "name": "created_at_tz_plus00_equivalent_to_z",
    "input_commands": [
      "DEFINE evt_tz_eq FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_tz_eq FOR tzZ PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00+00:00\"}",
      "FLUSH",
      "QUERY evt_tz_eq WHERE created_at=\"2025-01-01T00:00:00Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["tzZ"] }
  }
  ,
  {
    "name": "date_field_leap_day_eq",
    "input_commands": [
      "DEFINE birthdays_lp FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE birthdays_lp FOR lp1 PAYLOAD {\"id\":1,\"on\":\"2024-02-29\"}",
      "FLUSH",
      "QUERY birthdays_lp WHERE on=\"2024-02-29T00:00:00Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["lp1"] }
  }
  ,
  {
    "name": "since_using_created_at_us_input_inclusive",
    "input_commands": [
      "DEFINE evt_us FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_us FOR us1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_us FOR us2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_us FOR us1 SINCE \"1735689600000000\" USING created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "\"id\":1" },
      { "kind": "include_none", "value": ["\"id\":2"] }
    ]
  }
  ,
  {
    "name": "created_at_less_than_boundary_excludes_equal",
    "input_commands": [
      "DEFINE evt_lt FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_lt FOR l1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_lt FOR l2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_lt WHERE created_at < \"2025-01-01T00:00:01Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["l1"] }
  }
  ,
  {
    "name": "created_at_or_two_values",
    "input_commands": [
      "DEFINE evt_or FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_or FOR o1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_or FOR o2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_or WHERE created_at=\"2025-01-01T00:00:00Z\" OR created_at=\"2025-01-01T00:00:01Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["o1","o2"] }
  }
  ,
  {
    "name": "since_on_date_field_and_where_on_datetime",
    "input_commands": [
      "DEFINE evt_mixed_time FIELDS { \"id\": \"int\", \"on\": \"date\", \"created_at\": \"datetime\" }",
      "STORE evt_mixed_time FOR mx1 PAYLOAD {\"id\":1,\"on\":\"2025-01-01\",\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_mixed_time FOR mx2 PAYLOAD {\"id\":2,\"on\":\"2025-01-02\",\"created_at\":\"2025-01-02T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_mixed_time SINCE \"2025-01-02T00:00:00Z\" USING on WHERE created_at=\"2025-01-02T00:00:01Z\""
    ],
    "matcher": { "kind": "include_all", "value": ["mx2"] }
  }
  ,
  {
    "name": "streaming_memtable_basic",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE streaming_basic FIELDS { \"value\": \"int\" }",
      "STORE streaming_basic FOR mem-1 PAYLOAD {\"value\":1}",
      "STORE streaming_basic FOR mem-2 PAYLOAD {\"value\":2}",
      "QUERY streaming_basic WHERE value >= 0"
    ],
    "matchers": [
      { "kind": "include", "value": "\"type\":\"schema\"" },
      { "kind": "include_all", "value": ["mem-1", "mem-2"] },
      { "kind": "include", "value": "\"type\":\"end\"" }
    ]
  }
  ,
  {
    "name": "streaming_segment_and_memtable",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE streaming_mix FIELDS { \"value\": \"int\" }",
      "STORE streaming_mix FOR seg-ctx PAYLOAD {\"value\":1}",
      "STORE streaming_mix FOR seg-ctx2 PAYLOAD {\"value\":2}",
      "FLUSH",
      "STORE streaming_mix FOR mem-ctx PAYLOAD {\"value\":3}",
      "QUERY streaming_mix WHERE value >= 0"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["seg-ctx", "seg-ctx2", "mem-ctx"] },
      { "kind": "include", "value": "\"type\":\"schema\"" },
      { "kind": "include", "value": "\"type\":\"end\"" }
    ]
  }
  ,
  {
    "name": "streaming_limit_offset",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE streaming_limit FIELDS { \"value\": \"int\" }",
      "STORE streaming_limit FOR ctx-1 PAYLOAD {\"value\":10}",
      "STORE streaming_limit FOR ctx-2 PAYLOAD {\"value\":20}",
      "STORE streaming_limit FOR ctx-3 PAYLOAD {\"value\":30}",
      "STORE streaming_limit FOR ctx-4 PAYLOAD {\"value\":40}",
      "QUERY streaming_limit WHERE value >= 0 OFFSET 1 LIMIT 2"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["ctx-2", "ctx-3"] },
      { "kind": "include_none", "value": ["ctx-1", "ctx-4"] },
      { "kind": "include", "value": "\"row_count\":2" }
    ]
  }
  ,
  {
    "name": "streaming_order_by_limit",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE streaming_order FIELDS { \"value\": \"int\" }",
      "STORE streaming_order FOR seg-1 PAYLOAD {\"value\":30}",
      "STORE streaming_order FOR seg-2 PAYLOAD {\"value\":10}",
      "FLUSH",
      "STORE streaming_order FOR mem-1 PAYLOAD {\"value\":20}",
      "STORE streaming_order FOR mem-2 PAYLOAD {\"value\":40}",
      "QUERY streaming_order ORDER BY value ASC LIMIT 3"
    ],
    "matchers": [
      { "kind": "include", "value": "\"type\":\"schema\"" },
      { "kind": "regex", "value": "seg-2(?s).*mem-1(?s).*seg-1" },
      { "kind": "include", "value": "\"type\":\"end\"" }
    ]
  },
  {
    "name": "sequence_followed_by_basic",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1", "u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_with_where_clause",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\""
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_preceded_by_basic",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"amount\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"amount\":100}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_preceded_by_with_where_clause",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"amount\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"amount\":100}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE payment_failed FOR u2 PAYLOAD {\"user_id\":\"u2\",\"amount\":200}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id WHERE order_created.status=\"done\""
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_no_match",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_out_of_order",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_multiple_users",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"checkout\""
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1", "u2", "u3"] }
    ]
  },
  {
    "name": "sequence_linked_by_order_id",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "DEFINE order_cancelled FIELDS { \"order_id\": \"int\", \"reason\": \"string\" }",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_cancelled FOR u1 PAYLOAD {\"order_id\":1,\"reason\":\"changed_mind\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY order_created FOLLOWED BY order_cancelled LINKED BY order_id"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["1,\"u1\""] },
      { "kind": "include_none", "value": ["2,\"u2\""] }
    ]
  },
  {
    "name": "sequence_followed_by_with_common_where",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"timestamp\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"timestamp\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\",\"timestamp\":1000}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"timestamp\":2000}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\",\"timestamp\":3000}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"timestamp\":4000}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE timestamp > 500"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1", "u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_with_and_where",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\" AND order_created.status=\"done\""
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_preceded_by_multiple_events",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"attempt\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"attempt\":1}",
      "SLEEP 1000",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"attempt\":2}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_limit",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\" LIMIT 2"
    ],
    "matchers": [
      { "kind": "include", "value": "u1" },
      { "kind": "include", "value": "u2" },
      { "kind": "include_none", "value": ["u3"] }
    ]
  },
  {
    "name": "sequence_followed_by_same_timestamp",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\", \"created_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\", \"created_at\":\"2025-01-01T10:00:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id USING TIME created_at"
    ],
    "matchers": [
      { "kind": "include", "value": "u1" },
      { "kind": "include", "value": "page_view" },
      { "kind": "include", "value": "order_created" }
    ]
  },
  {
    "name": "sequence_followed_by_different_link_values",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":1,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_with_numeric_link_field",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"customer_id\": \"int\" }",
      "DEFINE order_shipped FIELDS { \"order_id\": \"int\", \"customer_id\": \"int\" }",
      "STORE order_created FOR c1 PAYLOAD {\"order_id\":1,\"customer_id\":100}",
      "SLEEP 1000",
      "STORE order_shipped FOR c1 PAYLOAD {\"order_id\":1,\"customer_id\":100}",
      "STORE order_created FOR c2 PAYLOAD {\"order_id\":2,\"customer_id\":200}",
      "FLUSH",
      "QUERY order_created FOLLOWED BY order_shipped LINKED BY customer_id"
    ],
    "matchers": [
      { "kind": "include_all", "value": [",100,1"] },
      { "kind": "include_none", "value": [",200,1"] }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1", "u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field_and_where",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\", \"amount\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\",\"amount\":100}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\",\"amount\":50}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at WHERE purchase.amount > 75"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field_and_limit",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u3\",\"viewed_at\":\"2025-01-01T12:00:00Z\"}",
      "STORE purchase FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"viewed_at\":\"2025-01-01T12:15:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at LIMIT 2"
    ],
    "matchers": [
      { "kind": "include", "value": "u1" },
      { "kind": "include", "value": "u2" },
      { "kind": "include_none", "value": ["u3"] }
    ]
  },
  {
    "name": "sequence_preceded_by_with_time_field",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"failed_at\": \"datetime\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"failed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"created_at\":\"2025-01-01T10:30:00Z\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"created_at\":\"2025-01-01T11:00:00Z\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id USING TIME created_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] },
      { "kind": "include_none", "value": ["u2"] }
    ]
  },
  {
    "name": "sequence_with_time_field_numeric_timestamp",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"ts\": \"int\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"ts\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"ts\":1735689600}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"ts\":1735689900}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"ts\":1735690000}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"ts\":1735690300}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME ts"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1", "u2"] }
    ]
  },
  {
    "name": "sequence_with_different_time_fields",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\", \"purchased_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"purchased_at\":\"2025-01-01T13:05:00Z\",\"viewed_at\":\"2025-01-01T12:00:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at"
    ],
    "matchers": [
      { "kind": "include_all", "value": ["u1"] }
    ]
  }
  ,
  {
    "name": "query_in_operator_numeric_basic",
    "input_commands": [
      "DEFINE in_numeric FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_numeric FOR ctx1 PAYLOAD {\"id\":1,\"value\":10}",
      "STORE in_numeric FOR ctx2 PAYLOAD {\"id\":2,\"value\":20}",
      "STORE in_numeric FOR ctx3 PAYLOAD {\"id\":3,\"value\":30}",
      "STORE in_numeric FOR ctx4 PAYLOAD {\"id\":4,\"value\":40}",
      "STORE in_numeric FOR ctx5 PAYLOAD {\"id\":5,\"value\":50}",
      "FLUSH",
      "QUERY in_numeric WHERE id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx3",
          "ctx5"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_string_basic",
    "input_commands": [
      "DEFINE in_string FIELDS { \"status\": \"string\", \"value\": \"int\" }",
      "STORE in_string FOR s1 PAYLOAD {\"status\":\"pending\",\"value\":10}",
      "STORE in_string FOR s2 PAYLOAD {\"status\":\"active\",\"value\":20}",
      "STORE in_string FOR s3 PAYLOAD {\"status\":\"completed\",\"value\":30}",
      "STORE in_string FOR s4 PAYLOAD {\"status\":\"cancelled\",\"value\":40}",
      "FLUSH",
      "QUERY in_string WHERE status IN (\"active\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "s2",
          "s3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "s1",
          "s4"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_single_value",
    "input_commands": [
      "DEFINE in_single FIELDS { \"id\": \"int\" }",
      "STORE in_single FOR v1 PAYLOAD {\"id\":1}",
      "STORE in_single FOR v2 PAYLOAD {\"id\":2}",
      "STORE in_single FOR v3 PAYLOAD {\"id\":3}",
      "FLUSH",
      "QUERY in_single WHERE id IN (2)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "v2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "v1",
          "v3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_no_matches",
    "input_commands": [
      "DEFINE in_no_match FIELDS { \"id\": \"int\" }",
      "STORE in_no_match FOR n1 PAYLOAD {\"id\":1}",
      "STORE in_no_match FOR n2 PAYLOAD {\"id\":2}",
      "STORE in_no_match FOR n3 PAYLOAD {\"id\":3}",
      "FLUSH",
      "QUERY in_no_match WHERE id IN (10, 20, 30)"
    ],
    "matcher": {
      "kind": "include",
      "value": "No matching events found"
    }
  }
  ,
  {
    "name": "query_in_operator_with_and",
    "input_commands": [
      "DEFINE in_and FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE in_and FOR a1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE in_and FOR a2 PAYLOAD {\"id\":2,\"status\":\"active\"}",
      "STORE in_and FOR a3 PAYLOAD {\"id\":3,\"status\":\"inactive\"}",
      "STORE in_and FOR a4 PAYLOAD {\"id\":4,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_and WHERE id IN (2, 4, 6) AND status=\"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "a2",
          "a4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "a1",
          "a3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_or",
    "input_commands": [
      "DEFINE in_or FIELDS { \"id\": \"int\", \"category\": \"string\" }",
      "STORE in_or FOR o1 PAYLOAD {\"id\":1,\"category\":\"A\"}",
      "STORE in_or FOR o2 PAYLOAD {\"id\":2,\"category\":\"A\"}",
      "STORE in_or FOR o3 PAYLOAD {\"id\":3,\"category\":\"A\"}",
      "STORE in_or FOR o4 PAYLOAD {\"id\":6,\"category\":\"B\"}",
      "STORE in_or FOR o5 PAYLOAD {\"id\":7,\"category\":\"B\"}",
      "FLUSH",
      "QUERY in_or WHERE id IN (1, 2, 3) OR category=\"B\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "o1",
          "o2",
          "o3",
          "o4",
          "o5"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_not",
    "input_commands": [
      "DEFINE in_not FIELDS { \"id\": \"int\" }",
      "STORE in_not FOR n1 PAYLOAD {\"id\":1}",
      "STORE in_not FOR n2 PAYLOAD {\"id\":2}",
      "STORE in_not FOR n3 PAYLOAD {\"id\":3}",
      "STORE in_not FOR n4 PAYLOAD {\"id\":4}",
      "STORE in_not FOR n5 PAYLOAD {\"id\":5}",
      "FLUSH",
      "QUERY in_not WHERE NOT id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "n1",
          "n3",
          "n5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "n2",
          "n4"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_order_by_limit",
    "input_commands": [
      "DEFINE in_order FIELDS { \"id\": \"int\", \"score\": \"int\" }",
      "STORE in_order FOR ord1 PAYLOAD {\"id\":2,\"score\":20}",
      "STORE in_order FOR ord2 PAYLOAD {\"id\":5,\"score\":50}",
      "STORE in_order FOR ord3 PAYLOAD {\"id\":8,\"score\":80}",
      "STORE in_order FOR ord4 PAYLOAD {\"id\":1,\"score\":10}",
      "STORE in_order FOR ord5 PAYLOAD {\"id\":9,\"score\":90}",
      "FLUSH",
      "QUERY in_order WHERE id IN (2, 5, 8, 1, 9) ORDER BY score DESC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "\"score\":90",
          "\"score\":80",
          "\"score\":50"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "\"score\":20",
          "\"score\":10"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_aggregation",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_agg FIELDS { \"region\": \"string\", \"amount\": \"int\" }",
      "STORE in_agg FOR agg1 PAYLOAD {\"region\":\"US\",\"amount\":10}",
      "STORE in_agg FOR agg2 PAYLOAD {\"region\":\"EU\",\"amount\":20}",
      "STORE in_agg FOR agg3 PAYLOAD {\"region\":\"ASIA\",\"amount\":30}",
      "STORE in_agg FOR agg4 PAYLOAD {\"region\":\"US\",\"amount\":40}",
      "STORE in_agg FOR agg5 PAYLOAD {\"region\":\"EU\",\"amount\":50}",
      "FLUSH",
      "QUERY in_agg WHERE region IN (\"US\", \"EU\") COUNT, TOTAL amount BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"US\",2,50"
      },
      {
        "kind": "include",
        "value": "\"EU\",2,70"
      },
      {
        "kind": "include_none",
        "value": [
          "ASIA"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_negative_numbers",
    "input_commands": [
      "DEFINE in_neg FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_neg FOR neg1 PAYLOAD {\"id\":-5,\"value\":10}",
      "STORE in_neg FOR neg2 PAYLOAD {\"id\":-3,\"value\":20}",
      "STORE in_neg FOR neg3 PAYLOAD {\"id\":0,\"value\":30}",
      "STORE in_neg FOR neg4 PAYLOAD {\"id\":2,\"value\":40}",
      "STORE in_neg FOR neg5 PAYLOAD {\"id\":4,\"value\":50}",
      "FLUSH",
      "QUERY in_neg WHERE id IN (-3, -1, 0, 2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "neg2",
          "neg3",
          "neg4",
          "neg5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "neg1"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_memtable_only",
    "config": {
      "engine": { "fill_factor": 100 }
    },
    "input_commands": [
      "DEFINE in_mem FIELDS { \"id\": \"int\" }",
      "STORE in_mem FOR mem1 PAYLOAD {\"id\":1}",
      "STORE in_mem FOR mem2 PAYLOAD {\"id\":2}",
      "STORE in_mem FOR mem3 PAYLOAD {\"id\":3}",
      "STORE in_mem FOR mem4 PAYLOAD {\"id\":4}",
      "QUERY in_mem WHERE id IN (2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mem2",
          "mem4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mem1",
          "mem3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_numeric_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_stream_num FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_stream_num FOR s1 PAYLOAD {\"id\":1,\"value\":10}",
      "STORE in_stream_num FOR s2 PAYLOAD {\"id\":2,\"value\":20}",
      "STORE in_stream_num FOR s3 PAYLOAD {\"id\":3,\"value\":30}",
      "STORE in_stream_num FOR s4 PAYLOAD {\"id\":4,\"value\":40}",
      "STORE in_stream_num FOR s5 PAYLOAD {\"id\":5,\"value\":50}",
      "FLUSH",
      "QUERY in_stream_num WHERE id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "s2",
          "s4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "s1",
          "s3",
          "s5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_string_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_stream_str FIELDS { \"status\": \"string\", \"priority\": \"int\" }",
      "STORE in_stream_str FOR str1 PAYLOAD {\"status\":\"pending\",\"priority\":1}",
      "STORE in_stream_str FOR str2 PAYLOAD {\"status\":\"active\",\"priority\":2}",
      "STORE in_stream_str FOR str3 PAYLOAD {\"status\":\"completed\",\"priority\":3}",
      "STORE in_stream_str FOR str4 PAYLOAD {\"status\":\"cancelled\",\"priority\":4}",
      "FLUSH",
      "QUERY in_stream_str WHERE status IN (\"active\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "str2",
          "str3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "str1",
          "str4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_and_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_and_stream FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE in_and_stream FOR as1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE in_and_stream FOR as2 PAYLOAD {\"id\":2,\"status\":\"active\"}",
      "STORE in_and_stream FOR as3 PAYLOAD {\"id\":3,\"status\":\"inactive\"}",
      "STORE in_and_stream FOR as4 PAYLOAD {\"id\":4,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_and_stream WHERE id IN (2, 4, 6) AND status=\"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "as2",
          "as4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "as1",
          "as3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_not_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_not_stream FIELDS { \"id\": \"int\" }",
      "STORE in_not_stream FOR ns1 PAYLOAD {\"id\":1}",
      "STORE in_not_stream FOR ns2 PAYLOAD {\"id\":2}",
      "STORE in_not_stream FOR ns3 PAYLOAD {\"id\":3}",
      "STORE in_not_stream FOR ns4 PAYLOAD {\"id\":4}",
      "STORE in_not_stream FOR ns5 PAYLOAD {\"id\":5}",
      "FLUSH",
      "QUERY in_not_stream WHERE NOT id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ns1",
          "ns3",
          "ns5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ns2",
          "ns4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_order_by_limit_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_order_stream FIELDS { \"id\": \"int\", \"score\": \"int\" }",
      "STORE in_order_stream FOR os1 PAYLOAD {\"id\":2,\"score\":20}",
      "STORE in_order_stream FOR os2 PAYLOAD {\"id\":5,\"score\":50}",
      "STORE in_order_stream FOR os3 PAYLOAD {\"id\":8,\"score\":80}",
      "STORE in_order_stream FOR os4 PAYLOAD {\"id\":1,\"score\":10}",
      "STORE in_order_stream FOR os5 PAYLOAD {\"id\":9,\"score\":90}",
      "FLUSH",
      "QUERY in_order_stream WHERE id IN (2, 5, 8, 1, 9) ORDER BY score DESC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "os5",
          "os3",
          "os2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "os1",
          "os4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_memtable_and_segment_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_mix_stream FIELDS { \"id\": \"int\" }",
      "STORE in_mix_stream FOR seg1 PAYLOAD {\"id\":1}",
      "STORE in_mix_stream FOR seg2 PAYLOAD {\"id\":2}",
      "FLUSH",
      "STORE in_mix_stream FOR mem1 PAYLOAD {\"id\":3}",
      "STORE in_mix_stream FOR mem2 PAYLOAD {\"id\":4}",
      "QUERY in_mix_stream WHERE id IN (2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "seg2",
          "mem2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "seg1",
          "mem1"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_or_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_or_stream FIELDS { \"id\": \"int\", \"category\": \"string\" }",
      "STORE in_or_stream FOR ors1 PAYLOAD {\"id\":1,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors2 PAYLOAD {\"id\":2,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors3 PAYLOAD {\"id\":3,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors4 PAYLOAD {\"id\":6,\"category\":\"B\"}",
      "STORE in_or_stream FOR ors5 PAYLOAD {\"id\":7,\"category\":\"B\"}",
      "FLUSH",
      "QUERY in_or_stream WHERE id IN (1, 2, 3) OR category=\"B\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ors1",
          "ors2",
          "ors3",
          "ors4",
          "ors5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_sequence_followed_by_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE order_created.status IN (\"done\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_sequence_with_event_specific_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page IN (\"/checkout\", \"/product\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_multiple_in_clauses_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE multi_in FIELDS { \"id\": \"int\", \"status\": \"string\", \"region\": \"string\" }",
      "STORE multi_in FOR mi1 PAYLOAD {\"id\":1,\"status\":\"active\",\"region\":\"US\"}",
      "STORE multi_in FOR mi2 PAYLOAD {\"id\":2,\"status\":\"active\",\"region\":\"EU\"}",
      "STORE multi_in FOR mi3 PAYLOAD {\"id\":3,\"status\":\"pending\",\"region\":\"US\"}",
      "STORE multi_in FOR mi4 PAYLOAD {\"id\":4,\"status\":\"active\",\"region\":\"ASIA\"}",
      "STORE multi_in FOR mi5 PAYLOAD {\"id\":5,\"status\":\"completed\",\"region\":\"EU\"}",
      "FLUSH",
      "QUERY multi_in WHERE id IN (1, 2, 3) AND status IN (\"active\", \"pending\") AND region IN (\"US\", \"EU\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mi1",
          "mi2",
          "mi3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mi4",
          "mi5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_temporal_field_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_temporal FIELDS { \"id\": \"int\", \"created_at\": \"datetime\", \"status\": \"string\" }",
      "STORE in_temporal FOR t1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\",\"status\":\"active\"}",
      "STORE in_temporal FOR t2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\",\"status\":\"active\"}",
      "STORE in_temporal FOR t3 PAYLOAD {\"id\":3,\"created_at\":\"2025-01-01T00:00:02Z\",\"status\":\"pending\"}",
      "STORE in_temporal FOR t4 PAYLOAD {\"id\":4,\"created_at\":\"2025-01-01T00:00:03Z\",\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_temporal WHERE created_at IN (\"2025-01-01T00:00:00Z\", \"2025-01-01T00:00:02Z\", \"2025-01-01T00:00:04Z\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "t1",
          "t3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "t2",
          "t4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_complex_and_or_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE complex_in FIELDS { \"id\": \"int\", \"category\": \"string\", \"priority\": \"int\" }",
      "STORE complex_in FOR c1 PAYLOAD {\"id\":1,\"category\":\"A\",\"priority\":1}",
      "STORE complex_in FOR c2 PAYLOAD {\"id\":2,\"category\":\"B\",\"priority\":2}",
      "STORE complex_in FOR c3 PAYLOAD {\"id\":3,\"category\":\"A\",\"priority\":3}",
      "STORE complex_in FOR c4 PAYLOAD {\"id\":4,\"category\":\"C\",\"priority\":1}",
      "STORE complex_in FOR c5 PAYLOAD {\"id\":5,\"category\":\"B\",\"priority\":3}",
      "FLUSH",
      "QUERY complex_in WHERE (id IN (1, 2, 3) AND category IN (\"A\", \"B\")) OR priority IN (3)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "c1",
          "c2",
          "c3",
          "c5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "c4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_with_aggregation_group_by_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE in_agg_group FIELDS { \"region\": \"string\", \"amount\": \"int\", \"status\": \"string\" }",
      "STORE in_agg_group FOR ag1 PAYLOAD {\"region\":\"US\",\"amount\":10,\"status\":\"active\"}",
      "STORE in_agg_group FOR ag2 PAYLOAD {\"region\":\"US\",\"amount\":20,\"status\":\"pending\"}",
      "STORE in_agg_group FOR ag3 PAYLOAD {\"region\":\"EU\",\"amount\":30,\"status\":\"active\"}",
      "STORE in_agg_group FOR ag4 PAYLOAD {\"region\":\"EU\",\"amount\":40,\"status\":\"completed\"}",
      "STORE in_agg_group FOR ag5 PAYLOAD {\"region\":\"ASIA\",\"amount\":50,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_agg_group WHERE status IN (\"active\", \"pending\") COUNT, AVG amount BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"US\",2,15.0"
      },
      {
        "kind": "include",
        "value": "\"EU\",1,30.0"
      },
      {
        "kind": "include",
        "value": "\"ASIA\",1,50.0"
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_in_operator_sequence_with_in_and_not_streaming",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page IN (\"/checkout\", \"/product\") AND NOT order_created.status IN (\"pending\", \"cancelled\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2",
          "u3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_with_or_and_and",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE paren_or_and FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE paren_or_and FOR ctx1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE paren_or_and FOR ctx2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE paren_or_and FOR ctx3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE paren_or_and FOR ctx4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "STORE paren_or_and FOR ctx5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":6}",
      "FLUSH",
      "QUERY paren_or_and WHERE (status = \"active\" OR status = \"pending\") AND priority > 5"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx2",
          "ctx4",
          "ctx5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_nested_or_and",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE nested_paren FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE nested_paren FOR n1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE nested_paren FOR n2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE nested_paren FOR n3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE nested_paren FOR n4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6}",
      "STORE nested_paren FOR n5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":4}",
      "FLUSH",
      "QUERY nested_paren WHERE (status = \"active\" OR status = \"pending\") AND (priority > 4 OR priority < 2)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "n2",
          "n3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "n1",
          "n4",
          "n5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_or_different_fields",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE diff_fields FIELDS { \"id\": \"int\", \"status\": \"string\", \"category\": \"string\" }",
      "STORE diff_fields FOR d1 PAYLOAD {\"id\":1,\"status\":\"active\",\"category\":\"A\"}",
      "STORE diff_fields FOR d2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"category\":\"B\"}",
      "STORE diff_fields FOR d3 PAYLOAD {\"id\":3,\"status\":\"completed\",\"category\":\"A\"}",
      "STORE diff_fields FOR d4 PAYLOAD {\"id\":4,\"status\":\"active\",\"category\":\"C\"}",
      "FLUSH",
      "QUERY diff_fields WHERE (status = \"active\" OR category = \"B\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "d1",
          "d2",
          "d4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "d3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_triple_nested",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE triple_nest FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\", \"category\": \"string\" }",
      "STORE triple_nest FOR t1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3,\"category\":\"A\"}",
      "STORE triple_nest FOR t2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5,\"category\":\"B\"}",
      "STORE triple_nest FOR t3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7,\"category\":\"A\"}",
      "STORE triple_nest FOR t4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6,\"category\":\"B\"}",
      "FLUSH",
      "QUERY triple_nest WHERE ((status = \"active\" OR status = \"pending\") AND priority > 4) OR category = \"A\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "t1",
          "t2",
          "t3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "t4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_with_in_operator",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE paren_in FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE paren_in FOR pi1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE paren_in FOR pi2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE paren_in FOR pi3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE paren_in FOR pi4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY paren_in WHERE (id IN (1, 2, 3) AND status = \"active\") OR priority > 6"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "pi1",
          "pi3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "pi2",
          "pi4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_multiple_and_or",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE multi_and_or FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\", \"category\": \"string\" }",
      "STORE multi_and_or FOR m1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3,\"category\":\"A\"}",
      "STORE multi_and_or FOR m2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5,\"category\":\"B\"}",
      "STORE multi_and_or FOR m3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7,\"category\":\"A\"}",
      "STORE multi_and_or FOR m4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6,\"category\":\"B\"}",
      "STORE multi_and_or FOR m5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":4,\"category\":\"C\"}",
      "FLUSH",
      "QUERY multi_and_or WHERE (status = \"active\" OR status = \"pending\") AND (priority > 4 OR category = \"A\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "m1",
          "m2",
          "m3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "m4",
          "m5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_with_not_and_or",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE not_paren FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_paren FOR np1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_paren FOR np2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE not_paren FOR np3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE not_paren FOR np4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY not_paren WHERE NOT (status = \"active\" OR status = \"pending\") AND priority > 1"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "np4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "np1",
          "np2",
          "np3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_not_with_and_de_morgan",
    "input_commands": [
      "DEFINE not_and FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_and FOR na1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_and FOR na2 PAYLOAD {\"id\":2,\"status\":\"active\",\"priority\":5}",
      "STORE not_and FOR na3 PAYLOAD {\"id\":3,\"status\":\"pending\",\"priority\":3}",
      "STORE not_and FOR na4 PAYLOAD {\"id\":4,\"status\":\"pending\",\"priority\":5}",
      "FLUSH",
      "QUERY not_and WHERE NOT (status = \"active\" AND priority > 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "na1",
          "na3",
          "na4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "na2"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_double_negation",
    "input_commands": [
      "DEFINE double_not FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE double_not FOR dn1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE double_not FOR dn2 PAYLOAD {\"id\":2,\"status\":\"pending\"}",
      "STORE double_not FOR dn3 PAYLOAD {\"id\":3,\"status\":\"completed\"}",
      "FLUSH",
      "QUERY double_not WHERE NOT NOT status = \"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "dn1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "dn2",
          "dn3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_with_not_and_or_non_streaming",
    "input_commands": [
      "DEFINE not_paren_ns FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_paren_ns FOR np1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_paren_ns FOR np2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE not_paren_ns FOR np3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE not_paren_ns FOR np4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY not_paren_ns WHERE NOT (status = \"active\" OR status = \"pending\") AND priority > 1"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "np4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "np1",
          "np2",
          "np3"
        ]
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_deeply_nested",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE deep_nest FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE deep_nest FOR dn1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE deep_nest FOR dn2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE deep_nest FOR dn3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE deep_nest FOR dn4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6}",
      "FLUSH",
      "QUERY deep_nest WHERE ((status = \"active\" OR status = \"pending\") AND priority > 4) OR (status = \"completed\" AND priority > 5)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "dn2",
          "dn3",
          "dn4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "dn1"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
  ,
  {
    "name": "query_parentheses_or_same_field_multiple_values",
    "config": { "query": { "streaming_enabled": true } },
    "input_commands": [
      "DEFINE multi_or FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE multi_or FOR mo1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE multi_or FOR mo2 PAYLOAD {\"id\":2,\"status\":\"pending\"}",
      "STORE multi_or FOR mo3 PAYLOAD {\"id\":3,\"status\":\"completed\"}",
      "STORE multi_or FOR mo4 PAYLOAD {\"id\":4,\"status\":\"cancelled\"}",
      "STORE multi_or FOR mo5 PAYLOAD {\"id\":5,\"status\":\"active\"}",
      "FLUSH",
      "QUERY multi_or WHERE status = \"active\" OR status = \"pending\" OR status = \"completed\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mo1",
          "mo2",
          "mo3",
          "mo5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mo4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  }
]