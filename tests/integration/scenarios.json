[
  {
    "name": "replay_projection_excludes_unreferenced_payload_field",
    "input_commands": [
      "DEFINE product FIELDS { \"name\": \"string\", \"price\": \"int\", \"color\": \"string\" }",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Desk\",\"price\":25,\"color\":\"red\"}",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Chair\",\"price\":50,\"color\":\"blue\"}",
      "FLUSH",
      "REPLAY product FOR user-1 RETURN [name]"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "Desk",
          "Chair",
          "\"type\":\"schema\"",
          "\"type\":\"batch\"",
          "\"type\":\"end\"",
          "\"row_count\":2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "color",
          "price",
          "red",
          "blue"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_without_definition",
    "input_commands": [
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "No schema defined"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "projection_excludes_unreferenced_payload_field",
    "input_commands": [
      "DEFINE product FIELDS { \"name\": \"string\", \"price\": \"int\", \"color\": \"string\" }",
      "STORE product FOR user-1 PAYLOAD {\"name\":\"Desk\",\"price\":25,\"color\":\"red\"}",
      "FLUSH",
      "QUERY product RETURN [name] WHERE price > 10"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "Desk"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "\"color\""
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_and_query_enum_eq",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-1 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR user-2 PAYLOAD {\"plan\": \"basic\"}",
      "QUERY subscription WHERE plan=\"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-2"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_and_query_enum_neq",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-3 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR user-4 PAYLOAD {\"plan\": \"basic\"}",
      "QUERY subscription WHERE plan!=\"basic\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-4"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_with_invalid_enum_value",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE subscription FOR user-1 PAYLOAD {\"plan\": \"enterprise\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "does not match expected type"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_with_invalid_payload",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\": \"a string\",\"status\":\"confirmed\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Field 'order_id' does not match expected type"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_with_missing_field",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Missing field 'status' in payload"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_with_invalid_field_type",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\", \"invalid_field\": \"a string\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Payload contains fields not defined in schema: invalid_field"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_with_optional_field_present",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\", \"optional_field\": \"string | null\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":123, \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":124, \"status\":\"confirmed\"}",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "123",
        "124"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_optional_field",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"string\", \"status\": \"string\", \"optional_field\": \"string | null\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-123\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-124\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-125\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-126\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-127\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-128\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-129\", \"status\":\"confirmed\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-130\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-131\", \"status\":\"confirmed\", \"optional_field\":\"a string\"}",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":\"order-132\", \"status\":\"confirmed\"}",
      "QUERY order_created WHERE optional_field=\"a string\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "order-123",
          "order-126",
          "order-128",
          "order-130",
          "order-131"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "order-124",
          "order-125",
          "order-127",
          "order-129",
          "order-132"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "simple_query_status_confirmed",
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-2 PAYLOAD {\"order_id\":2,\"status\":\"pending\"}",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"confirmed\",1]"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "simple_query_with_mixed_commands",
    "input_commands": [
      "define order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "Store order_created FoR customer-1 PAYLOAD {\"order_id\":123,\"status\":\"confirmed\"}",
      "STORe order_created For customer-2 PAYLOAD {\"order_id\":124,\"status\":\"pending\"}",
      "query order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "123"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "segment_memory_hybrid_query",
    "config": {
      "engine": {
        "fill_factor": 1
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_created FOR customer-1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-2 PAYLOAD {\"order_id\":2,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-3 PAYLOAD {\"order_id\":3,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-4 PAYLOAD {\"order_id\":4,\"status\":\"confirmed\"}",
      "STORE order_created FOR customer-5 PAYLOAD {\"order_id\":5,\"status\":\"pending\"}",
      "STORE order_created FOR customer-6 PAYLOAD {\"order_id\":6,\"status\":\"pending\"}",
      "STORE order_created FOR customer-7 PAYLOAD {\"order_id\":7,\"status\":\"confirmed\"}",
      "SLEEP 1000",
      "QUERY order_created WHERE status=\"confirmed\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "customer-1",
        "customer-2",
        "customer-3",
        "customer-4",
        "customer-7"
      ]
    }
  },
  {
    "name": "multi_context_query",
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR user-1 PAYLOAD {\"device\":\"android\"} ",
      "STORE login FOR user-2 PAYLOAD {\"device\":\"android\"} ",
      "STORE login FOR user-3 PAYLOAD {\"device\":\"web\"} ",
      "STORE login FOR user-4 PAYLOAD {\"device\":\"android\"} ",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-1",
        "user-2",
        "user-4"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_from_segment",
    "input_commands": [
      "DEFINE order_shipped FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":999,\"status\":\"shipped\"}",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":1000,\"status\":\"delivered\"}",
      "STORE order_shipped FOR customer-99 PAYLOAD {\"order_id\":1001,\"status\":\"delivered\"}",
      "STORE order_shipped FOR customer-100 PAYLOAD {\"order_id\":1002,\"status\":\"returned\"}",
      "FLUSH",
      "REPLAY order_shipped FOR customer-99"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "999",
          "1000",
          "1001",
          "customer-99",
          "\"type\":\"schema\"",
          "\"type\":\"batch\"",
          "\"type\":\"end\"",
          "\"row_count\":3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "1002",
          "customer-100"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_mixed_context",
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR alice PAYLOAD {\"device\":\"android\"}",
      "STORE login FOR alice PAYLOAD {\"device\":\"web\"}",
      "STORE login FOR bob PAYLOAD {\"device\":\"iphone\"}",
      "REPLAY FOR alice"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "android",
          "web",
          "alice",
          "\"row_count\":2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "bob",
          "iphone"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_on_boolean_flag",
    "input_commands": [
      "DEFINE review FIELDS { \"rating\": \"int\", \"verified\": \"bool\" }",
      "STORE review FOR u1 PAYLOAD {\"rating\":5,\"verified\":true}",
      "STORE review FOR u2 PAYLOAD {\"rating\":4,\"verified\":false}",
      "QUERY review WHERE verified=true"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_memory_only",
    "input_commands": [
      "DEFINE cart_updated FIELDS { \"sku\": \"string\", \"qty\": \"int\" }",
      "STORE cart_updated FOR user-1 PAYLOAD {\"sku\":\"ABC123\",\"qty\":2}",
      "QUERY cart_updated WHERE sku=\"ABC123\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ABC123"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_nonexistent_context",
    "input_commands": [
      "REPLAY FOR ghost-user"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"type\":\"schema\"",
        "\"type\":\"end\"",
        "\"row_count\":0"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_context_post_flush",
    "input_commands": [
      "DEFINE order_returned FIELDS { \"order_id\": \"int\", \"reason\": \"string\" }",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":991,\"reason\":\"broken\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":992,\"reason\":\"wrong_size\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":993,\"reason\":\"changed_mind\"}",
      "STORE order_returned FOR user-2 PAYLOAD {\"order_id\":994,\"reason\":\"late_delivery\"}",
      "FLUSH",
      "REPLAY order_returned FOR user-2"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "991",
        "992",
        "993",
        "994",
        "user-2",
        "\"type\":\"schema\"",
        "\"type\":\"batch\"",
        "\"type\":\"end\"",
        "\"row_count\":4"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_empty_event_type",
    "input_commands": [
      "QUERY nonexistent_type WHERE id=42"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_filter_single_match",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-1 PAYLOAD {\"id\":1,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-1"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_no_match",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-2 PAYLOAD {\"id\":2,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_multiple_matches",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-3 PAYLOAD {\"id\":3,\"country\":\"NL\"} ",
      "STORE order_created FOR user-4 PAYLOAD {\"id\":4,\"country\":\"NL\"} ",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-3",
        "user-4"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_multiple_shards",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-7 PAYLOAD {\"id\":7,\"country\":\"NL\"}",
      "STORE order_created FOR user-8 PAYLOAD {\"id\":8,\"country\":\"DE\"}",
      "STORE order_created FOR user-9 PAYLOAD {\"id\":9,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_created WHERE country=\"NL\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "user-7",
        "user-9"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_mixed_conditions",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-10 PAYLOAD {\"id\":10,\"country\":\"NL\"}",
      "STORE order_created FOR user-11 PAYLOAD {\"id\":11,\"country\":\"FR\"}",
      "STORE order_created FOR user-12 PAYLOAD {\"id\":12,\"country\":\"FR\"}",
      "QUERY order_created WHERE country=\"FR\" AND id > 11"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-12"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-10",
          "user-11"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_after_multiple_flushes",
    "input_commands": [
      "DEFINE order_create_1 FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_create_1 FOR user-12 PAYLOAD {\"id\":12,\"country\":\"DE\"}",
      "FLUSH",
      "STORE order_create_1 FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "FLUSH",
      "QUERY order_create_1 WHERE country=NL"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-12"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_inequality",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "QUERY order_created WHERE country!=\"NL\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_not",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "QUERY order_created WHERE NOT country=\"NL\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_or",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE country=\"NL\" OR country=\"FR\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13",
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-15"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_greater_than_or_equal",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE id >= 14"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14",
          "user-15"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-13"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_less_than_or_equal",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "QUERY order_created WHERE id <= 14"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-13",
          "user-14"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "user-15"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_with_logical_operators",
    "input_commands": [
      "DEFINE order_created FIELDS { \"id\": \"int\", \"country\": \"string\" }",
      "STORE order_created FOR user-13 PAYLOAD {\"id\":13,\"country\":\"NL\"}",
      "STORE order_created FOR user-14 PAYLOAD {\"id\":14,\"country\":\"FR\"}",
      "STORE order_created FOR user-15 PAYLOAD {\"id\":15,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY order_created WHERE id > 13 AND id < 15"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "user-14"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_limit_zero_no_results",
    "input_commands": [
      "DEFINE limit_zero FIELDS { \"status\": \"string\" }",
      "STORE limit_zero FOR a PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_zero FOR b PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_zero WHERE status=\"ok\" LIMIT 0"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_limit_memtable_only_two",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE limit_mem_only FIELDS { \"status\": \"string\" }",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_mem_only FOR u2 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_mem_only FOR u3 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_mem_only WHERE status=\"ok\" LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "\"row_count\":2"
        ]
      }
    ]
  },
  {
    "name": "query_limit_memtable_only_two_same_shard",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE limit_mem_only FIELDS { \"status\": \"int\" }",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":400}",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":500}",
      "STORE limit_mem_only FOR u1 PAYLOAD {\"status\":200}",
      "QUERY limit_mem_only LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",400]",
          ",500]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "\"status\":200"
        ]
      }
    ]
  },
  {
    "name": "query_limit_combines_memtable_and_segment",
    "input_commands": [
      "DEFINE limit_mix FIELDS { \"status\": \"string\" }",
      "STORE limit_mix FOR seg-ctx PAYLOAD {\"status\":\"ok\"}",
      "FLUSH",
      "STORE limit_mix FOR mem-ctx PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_mix WHERE status=\"ok\" LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "seg-ctx",
          "mem-ctx"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_limit_equal_to_total",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE limit_eq_total FIELDS { \"status\": \"string\" }",
      "STORE limit_eq_total FOR c1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_eq_total FOR c2 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_eq_total FOR c3 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_eq_total WHERE status=\"ok\" LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "c1",
          "c2",
          "c3"
        ]
      }
    ]
  },
  {
    "name": "query_limit_greater_than_total",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE limit_gt_total FIELDS { \"status\": \"string\" }",
      "STORE limit_gt_total FOR d1 PAYLOAD {\"status\":\"ok\"}",
      "STORE limit_gt_total FOR d2 PAYLOAD {\"status\":\"ok\"}",
      "QUERY limit_gt_total WHERE status=\"ok\" LIMIT 10"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "d1",
          "d2"
        ]
      }
    ]
  },
  {
    "name": "replay_since_using_created_at_iso8601",
    "input_commands": [
      "DEFINE evt_rp1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp1 FOR rctx PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp1 FOR rctx PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp1 FOR rctx SINCE \"2025-01-01T00:00:01Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "\"type\":\"schema\"",
          "\"type\":\"batch\"",
          "\"type\":\"end\"",
          "\"row_count\":1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "\"id\":1"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_since_using_created_at_ms",
    "input_commands": [
      "DEFINE evt_rp2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp2 FOR rctx2 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp2 FOR rctx2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp2 FOR rctx2 SINCE \"1735689600000\" USING created_at"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"type\":\"schema\"",
        "\"type\":\"batch\"",
        "\"type\":\"end\"",
        "\"row_count\":2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_since_using_date_field_midnight",
    "input_commands": [
      "DEFINE evt_rp3 FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE evt_rp3 FOR rctx3 PAYLOAD {\"id\":1,\"on\":\"2025-01-01\"}",
      "STORE evt_rp3 FOR rctx3 PAYLOAD {\"id\":2,\"on\":\"2025-01-02\"}",
      "FLUSH",
      "REPLAY evt_rp3 FOR rctx3 SINCE \"2025-01-02T00:00:00Z\" USING on"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"type\":\"schema\"",
        "\"type\":\"batch\"",
        "\"type\":\"end\"",
        "\"row_count\":1"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "replay_since_unparsable_ignored",
    "input_commands": [
      "DEFINE evt_rp4 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_rp4 FOR rctx4 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_rp4 FOR rctx4 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "REPLAY evt_rp4 FOR rctx4 SINCE \"bogus\" USING created_at"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "\"type\":\"schema\"",
        "\"type\":\"batch\"",
        "\"type\":\"end\"",
        "\"row_count\":2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "bucket_month_using_created_at_boundary",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders_time FIELDS { \"id\": \"int\", \"created_at\": \"datetime\", \"amount\": \"int\" }",
      "STORE orders_time FOR b1 PAYLOAD {\"id\":1,\"created_at\":1736639999,\"amount\":10}",
      "STORE orders_time FOR b2 PAYLOAD {\"id\":2,\"created_at\":1736640000,\"amount\":20}",
      "FLUSH",
      "QUERY orders_time TOTAL amount PER month USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"bucket\""
      },
      {
        "kind": "include_all",
        "value": [
          "1735689600",
          "1735689600"
        ]
      },
      {
        "kind": "include_all",
        "value": [
          "30"
        ]
      }
    ]
  },
  {
    "name": "bucket_week_using_created_at_negative_offset_cross_week",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE sessions FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE sessions FOR s1 PAYLOAD {\"id\":1,\"created_at\":1735171199}",
      "STORE sessions FOR s2 PAYLOAD {\"id\":2,\"created_at\":1735171200}",
      "FLUSH",
      "QUERY sessions COUNT PER week USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "[1734912000,2]"
        ]
      }
    ]
  },
  {
    "name": "bucket_day_using_date_field_midnight_normalization",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE birthdays FIELDS { \"id\": \"int\", \"birthdate\": \"date\" }",
      "STORE birthdays FOR bd1 PAYLOAD {\"id\":1,\"birthdate\":\"2025-09-06\"}",
      "STORE birthdays FOR bd2 PAYLOAD {\"id\":2,\"birthdate\":\"2025-09-06\"}",
      "STORE birthdays FOR bd3 PAYLOAD {\"id\":3,\"birthdate\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY birthdays COUNT PER day USING birthdate"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count\""
      },
      {
        "kind": "include",
        "value": "2"
      },
      {
        "kind": "include",
        "value": "1"
      }
    ]
  },
  {
    "name": "bucket_hour_using_created_at_ms_payload",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE clicks FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE clicks FOR c1 PAYLOAD {\"id\":1,\"created_at\":1735689600000}",
      "STORE clicks FOR c2 PAYLOAD {\"id\":2,\"created_at\":1735693199000}",
      "STORE clicks FOR c3 PAYLOAD {\"id\":3,\"created_at\":1735693200000}",
      "FLUSH",
      "QUERY clicks COUNT PER hour USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count\""
      },
      {
        "kind": "include",
        "value": "2"
      },
      {
        "kind": "include",
        "value": "1"
      }
    ]
  },
  {
    "name": "since_using_created_at_equal_boundary_included",
    "input_commands": [
      "DEFINE evt_eq FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_eq FOR ctxEq PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T23:59:59Z\"}",
      "STORE evt_eq FOR ctxEq PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_eq FOR ctxEq SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_ms_input",
    "input_commands": [
      "DEFINE evt_ms FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_ms FOR ctxMs PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_ms FOR ctxMs PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_ms FOR ctxMs SINCE \"1735689600000\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",1]",
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_ns_input_excludes_first",
    "input_commands": [
      "DEFINE evt_ns FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_ns FOR ctxNs PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_ns FOR ctxNs PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_ns FOR ctxNs SINCE \"1735689601000000000\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_minus_offset_boundary",
    "input_commands": [
      "DEFINE evt_neg_off FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_neg_off FOR ctxNo PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T18:59:59-05:00\"}",
      "STORE evt_neg_off FOR ctxNo PAYLOAD {\"id\":2,\"created_at\":\"2024-12-31T19:00:00-05:00\"}",
      "FLUSH",
      "QUERY evt_neg_off FOR ctxNo SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_created_at_ms_number_normalized",
    "input_commands": [
      "DEFINE evt_store_ms FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_store_ms FOR ctxSm PAYLOAD {\"id\":1,\"created_at\":1735689600000}",
      "STORE evt_store_ms FOR ctxSm PAYLOAD {\"id\":2,\"created_at\":1735689601000}",
      "FLUSH",
      "QUERY evt_store_ms FOR ctxSm SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",1]",
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_with_offset",
    "input_commands": [
      "DEFINE evt_off FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_off FOR ctxO PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T01:59:59+02:00\"}",
      "STORE evt_off FOR ctxO PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T02:00:01+02:00\"}",
      "FLUSH",
      "QUERY evt_off FOR ctxO SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_date_field",
    "input_commands": [
      "DEFINE people FIELDS { \"id\": \"int\", \"birthdate\": \"date\" }",
      "STORE people FOR pctx PAYLOAD {\"id\":1,\"birthdate\":\"2025-09-06\"}",
      "STORE people FOR pctx PAYLOAD {\"id\":2,\"birthdate\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY people FOR pctx SINCE \"2025-09-07T00:00:00Z\" USING birthdate"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "store_invalid_time_string_rejected",
    "input_commands": [
      "DEFINE evt_bad_time FIELDS { \"created_at\": \"datetime\" }",
      "STORE evt_bad_time FOR ctxBad PAYLOAD {\"created_at\":\"not-a-time\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Invalid time string"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_unparsable_ignored_includes_all",
    "input_commands": [
      "DEFINE evt_bogus FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_bogus FOR ctxBog PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "STORE evt_bogus FOR ctxBog PAYLOAD {\"id\":2,\"created_at\":\"2025-01-02T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_bogus FOR ctxBog SINCE \"bogus\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",1]",
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_optional_datetime_skips_nulls",
    "input_commands": [
      "DEFINE evt_opt_time FIELDS { \"id\": \"int\", \"created_at\": \"datetime | null\" }",
      "STORE evt_opt_time FOR ctxOpt PAYLOAD {\"id\":1,\"created_at\":null}",
      "STORE evt_opt_time FOR ctxOpt PAYLOAD {\"id\":2,\"created_at\":\"2025-01-02T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_opt_time FOR ctxOpt SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_iso8601_selection",
    "input_commands": [
      "DEFINE evt_time_sel1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_time_sel1 FOR ctxA PAYLOAD {\"id\":1,\"created_at\":\"2024-12-31T23:59:59Z\"}",
      "STORE evt_time_sel1 FOR ctxA PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_time_sel1 FOR ctxA SINCE \"2025-01-01T00:00:00Z\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",2]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_numeric_units_selection",
    "input_commands": [
      "DEFINE evt_time_sel2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_time_sel2 FOR ctxB PAYLOAD {\"id\":1,\"created_at\":1600000000000}",
      "STORE evt_time_sel2 FOR ctxB PAYLOAD {\"id\":2,\"created_at\":1600000100000}",
      "FLUSH",
      "QUERY evt_time_sel2 FOR ctxB SINCE \"1600000000\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",1]",
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "agg_count_per_day_by_country_and_plan",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\", \"plan\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\",\"plan\":\"pro\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"NL\",\"plan\":\"basic\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"DE\",\"plan\":\"pro\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":18,\"country\":\"NL\",\"plan\":\"pro\"}",
      "STORE orders FOR c5 PAYLOAD {\"amount\":11,\"country\":\"NL\",\"plan\":\"basic\"}",
      "FLUSH",
      "QUERY orders COUNT PER day BY country, plan"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"NL\",\"basic\",2"
      },
      {
        "kind": "include",
        "value": "\"NL\",\"pro\",2"
      },
      {
        "kind": "include",
        "value": "\"DE\",\"pro\",1"
      }
    ]
  },
  {
    "name": "agg_count_unique_user_by_country_per_week",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id PER week BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count_unique_user_id\""
      },
      {
        "kind": "include",
        "value": "\"NL\",1"
      },
      {
        "kind": "include",
        "value": "\"DE\",1"
      }
    ]
  },
  {
    "name": "agg_avg_min_max_with_filter_by_country",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\", \"status\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\",\"status\":\"ok\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":30,\"country\":\"NL\",\"status\":\"ok\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":25,\"country\":\"DE\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY orders WHERE status=\"ok\" AVG amount, MIN amount, MAX amount BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"avg_amount\""
      },
      {
        "kind": "include",
        "value": "\"min_amount\""
      },
      {
        "kind": "include",
        "value": "\"max_amount\""
      },
      {
        "kind": "include",
        "value": "\"NL\""
      },
      {
        "kind": "include",
        "value": "20.0"
      },
      {
        "kind": "include",
        "value": "10"
      },
      {
        "kind": "include",
        "value": "30"
      }
    ]
  },
  {
    "name": "agg_total_amount_group_by_two_fields_no_bucket",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"region\": \"string\", \"channel\": \"string\" }",
      "STORE orders FOR r1 PAYLOAD {\"amount\":5,\"region\":\"EU\",\"channel\":\"web\"}",
      "STORE orders FOR r2 PAYLOAD {\"amount\":7,\"region\":\"EU\",\"channel\":\"store\"}",
      "STORE orders FOR r3 PAYLOAD {\"amount\":9,\"region\":\"US\",\"channel\":\"web\"}",
      "FLUSH",
      "QUERY orders TOTAL amount BY region, channel"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"EU\",\"web\",5"
      },
      {
        "kind": "include",
        "value": "\"EU\",\"store\",7"
      },
      {
        "kind": "include",
        "value": "\"US\",\"web\",9"
      }
    ]
  },
  {
    "name": "agg_count_and_avg_per_hour_by_region",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE metrics FIELDS { \"value\": \"int\", \"region\": \"string\" }",
      "STORE metrics FOR m1 PAYLOAD {\"value\":1,\"region\":\"EU\"}",
      "STORE metrics FOR m2 PAYLOAD {\"value\":3,\"region\":\"EU\"}",
      "STORE metrics FOR m3 PAYLOAD {\"value\":2,\"region\":\"US\"}",
      "FLUSH",
      "QUERY metrics COUNT, AVG value PER hour BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"EU\",2,2.0"
      },
      {
        "kind": "include",
        "value": "\"US\",1,2.0"
      }
    ]
  },
  {
    "name": "agg_count_and_count_unique_by_country",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR a PAYLOAD {\"user_id\":\"X\",\"country\":\"NL\"}",
      "STORE login FOR b PAYLOAD {\"user_id\":\"Y\",\"country\":\"NL\"}",
      "STORE login FOR c PAYLOAD {\"user_id\":\"X\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT, COUNT UNIQUE user_id BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count\""
      },
      {
        "kind": "include",
        "value": "\"count_unique_user_id\""
      },
      {
        "kind": "include",
        "value": "\"NL\",3,2"
      }
    ]
  },
  {
    "name": "agg_count_all_simple",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "STORE evt FOR b PAYLOAD {\"v\":2}",
      "FLUSH",
      "QUERY evt COUNT"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"rows\":[[2]]"
    }
  },
  {
    "name": "agg_count_unique_by_country",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count_unique_user_id\""
      },
      {
        "kind": "include",
        "value": "\"NL\",1"
      },
      {
        "kind": "include",
        "value": "\"DE\",1"
      }
    ]
  },
  {
    "name": "agg_count_by_country",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"country\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\",\"country\":\"DE\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\",\"country\":\"NL\"}",
      "FLUSH",
      "QUERY login COUNT user_id BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"count_user_id\""
      },
      {
        "kind": "include",
        "value": "\"NL\",2"
      },
      {
        "kind": "include",
        "value": "\"DE\",1"
      }
    ]
  },
  {
    "name": "agg_avg_total_min_max_per_month_by_country",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"NL\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders AVG amount, TOTAL amount, MIN amount, MAX amount PER month BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"DE\",15.0,15,15,15"
      },
      {
        "kind": "include",
        "value": "\"NL\",15.0,30,10,20"
      }
    ]
  },
  {
    "name": "agg_multiple_ops_no_group",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"x\": \"int\", \"y\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"x\":1,\"y\":2}",
      "STORE evt FOR b PAYLOAD {\"x\":3,\"y\":4}",
      "FLUSH",
      "QUERY evt AVG x, MIN y, MAX y, TOTAL x"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"rows\":[[2.0,2,4,4]]"
      }
    ]
  },
  {
    "name": "agg_count_only_with_filter",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"kind\": \"string\" }",
      "STORE evt FOR k1 PAYLOAD {\"kind\":\"a\"}",
      "STORE evt FOR k2 PAYLOAD {\"kind\":\"b\"}",
      "STORE evt FOR k3 PAYLOAD {\"kind\":\"a\"}",
      "FLUSH",
      "QUERY evt WHERE kind=\"a\" COUNT"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"rows\":[[2]]"
    }
  },
  {
    "name": "agg_scalar_avg_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":30}",
      "FLUSH",
      "QUERY orders AVG amount"
    ],
    "matcher": {
      "kind": "include",
      "value": "[[20.0]]"
    }
  },
  {
    "name": "agg_scalar_total_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":30}",
      "FLUSH",
      "QUERY orders TOTAL amount"
    ],
    "matcher": {
      "kind": "include",
      "value": "[[60]]"
    }
  },
  {
    "name": "agg_scalar_min_max_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":30}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":20}",
      "FLUSH",
      "QUERY orders MIN amount, MAX amount"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[10,30]"
      }
    ]
  },
  {
    "name": "agg_count_with_limit_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"FR\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"FR\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":25,\"country\":\"IT\"}",
      "FLUSH",
      "QUERY orders COUNT BY country ORDER BY country DESC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[\"NL\",1],[\"IT\",1]"
      }
    ]
  },
  {
    "name": "agg_avg_merging_accuracy_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      },
      "engine": {
        "shard_count": 2
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"category\": \"string\" }",
      "STORE orders FOR shard1-c1 PAYLOAD {\"amount\":10,\"category\":\"A\"}",
      "STORE orders FOR shard1-c2 PAYLOAD {\"amount\":20,\"category\":\"A\"}",
      "FLUSH",
      "STORE orders FOR shard2-c3 PAYLOAD {\"amount\":30,\"category\":\"A\"}",
      "FLUSH",
      "QUERY orders AVG amount BY category"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[[\"A\",20.0]]"
      }
    ]
  },
  {
    "name": "agg_count_unique_merging_accuracy_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      },
      "engine": {
        "shard_count": 2
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\", \"region\": \"string\" }",
      "STORE login FOR shard1-r1 PAYLOAD {\"user_id\":\"user1\",\"region\":\"EU\"}",
      "STORE login FOR shard1-r2 PAYLOAD {\"user_id\":\"user2\",\"region\":\"EU\"}",
      "FLUSH",
      "STORE login FOR shard2-r3 PAYLOAD {\"user_id\":\"user1\",\"region\":\"EU\"}",
      "STORE login FOR shard2-r4 PAYLOAD {\"user_id\":\"user3\",\"region\":\"EU\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[[\"EU\",3]]"
      }
    ]
  },
  {
    "name": "agg_scalar_count_unique_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"user_id\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"user_id\":\"A\"}",
      "STORE login FOR u2 PAYLOAD {\"user_id\":\"B\"}",
      "STORE login FOR u3 PAYLOAD {\"user_id\":\"A\"}",
      "FLUSH",
      "QUERY login COUNT UNIQUE user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "[[2]]"
    }
  },
  {
    "name": "agg_multiple_ops_with_limit_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"DE\"}",
      "STORE orders FOR c3 PAYLOAD {\"amount\":15,\"country\":\"IT\"}",
      "STORE orders FOR c4 PAYLOAD {\"amount\":25,\"country\":\"IT\"}",
      "FLUSH",
      "QUERY orders AVG amount, TOTAL amount BY country ORDER BY country DESC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[[\"NL\",10.0,10],[\"IT\",20.0,40]]"
      }
    ]
  },
  {
    "name": "agg_empty_groups_filtered_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"amount\": \"int\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"amount\":10,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"amount\":20,\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders COUNT BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[\"NL\",1]"
      },
      {
        "kind": "include",
        "value": "[\"DE\",1]"
      }
    ]
  },
  {
    "name": "agg_count_field_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int | null\", \"country\": \"string\" }",
      "STORE orders FOR c1 PAYLOAD {\"order_id\":1,\"country\":\"NL\"}",
      "STORE orders FOR c2 PAYLOAD {\"order_id\":2,\"country\":\"NL\"}",
      "STORE orders FOR c3 PAYLOAD {\"country\":\"DE\"}",
      "FLUSH",
      "QUERY orders COUNT order_id BY country"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"NL\",2"
      }
    ]
  },
  {
    "name": "agg_all_operations_comprehensive_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE metrics FIELDS { \"value\": \"int\", \"user_id\": \"string\", \"category\": \"string\" }",
      "STORE metrics FOR m1 PAYLOAD {\"value\":10,\"user_id\":\"A\",\"category\":\"X\"}",
      "STORE metrics FOR m2 PAYLOAD {\"value\":20,\"user_id\":\"B\",\"category\":\"X\"}",
      "STORE metrics FOR m3 PAYLOAD {\"value\":15,\"user_id\":\"A\",\"category\":\"Y\"}",
      "STORE metrics FOR m4 PAYLOAD {\"value\":25,\"user_id\":\"C\",\"category\":\"X\"}",
      "FLUSH",
      "QUERY metrics COUNT, COUNT UNIQUE user_id, AVG value, TOTAL value, MIN value, MAX value BY category"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "[[\"X\",3,3,18.333333333333332,55,10,25],[\"Y\",1,1,15.0,15,15,15]]"
      }
    ]
  },
  {
    "name": "enum_store_wrong_case_rejected",
    "input_commands": [
      "DEFINE plan_change FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE plan_change FOR u1 PAYLOAD {\"plan\": \"Pro\"}"
    ],
    "matcher": {
      "kind": "include",
      "value": "does not match expected type"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "enum_query_wrong_case_returns_no_results",
    "input_commands": [
      "DEFINE plan_change FIELDS { \"plan\": [\"pro\", \"basic\"] }",
      "STORE plan_change FOR u1 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY plan_change WHERE plan=\"Pro\""
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "ebm_eq_logs_pruning",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"pro\" OR plan = \"premium\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx4"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "ebm_neq_logs_pruning",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "FLUSH",
      "QUERY subscription WHERE plan != \"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx1",
          "ctx3",
          "ctx4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx2"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "ebm_unknown_variant_no_results",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR u1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR u2 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"unknown\""
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "ebm_eq_across_two_zones",
    "input_commands": [
      "DEFINE subscription FIELDS { \"plan\": [\"free\", \"pro\", \"premium\", \"enterprise\"] }",
      "STORE subscription FOR ctx1 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx2 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx3 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx4 PAYLOAD {\"plan\": \"enterprise\"}",
      "STORE subscription FOR ctx5 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx6 PAYLOAD {\"plan\": \"free\"}",
      "STORE subscription FOR ctx7 PAYLOAD {\"plan\": \"pro\"}",
      "STORE subscription FOR ctx8 PAYLOAD {\"plan\": \"premium\"}",
      "STORE subscription FOR ctx9 PAYLOAD {\"plan\": \"pro\"}",
      "FLUSH",
      "QUERY subscription WHERE plan = \"pro\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx5",
          "ctx7",
          "ctx9"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx3",
          "ctx4",
          "ctx6",
          "ctx8"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_hits_memtable_only",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE hot_path FIELDS { \"device\": \"string\" }",
      "STORE hot_path FOR u1 PAYLOAD {\"device\":\"android\"}",
      "STORE hot_path FOR u2 PAYLOAD {\"device\":\"iphone\"}",
      "STORE hot_path FOR u3 PAYLOAD {\"device\":\"android\"}",
      "QUERY hot_path WHERE device=\"android\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "query_hits_passive_memtable",
    "config": {
      "engine": {
        "fill_factor": 1
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE warm_path FIELDS { \"device\": \"string\" }",
      "STORE warm_path FOR u1 PAYLOAD {\"device\":\"android\"}",
      "QUERY warm_path WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "u1"
      ]
    }
  },
  {
    "name": "wal_reload_after_restart",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "u1"
      ]
    }
  },
  {
    "name": "wal_recover_no_flush",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "u1"
      ]
    }
  },
  {
    "name": "wal_disabled_no_recovery",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "wal": {
        "enabled": false
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "wal_multi_log_recovery",
    "config": {
      "engine": {
        "fill_factor": 2
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "STORE evt FOR b PAYLOAD {\"v\":2}",
      "STORE evt FOR c PAYLOAD {\"v\":3}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY evt WHERE v>=1"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "a",
        "b",
        "c"
      ]
    }
  },
  {
    "name": "wal_recover_during_pending_flush",
    "config": {
      "engine": {
        "fill_factor": 1
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR a PAYLOAD {\"v\":1}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY evt WHERE v=1"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "a"
      ]
    }
  },
  {
    "name": "wal_flush_then_restart_segment_only",
    "config": {
      "engine": {
        "fill_factor": 2
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE order FIELDS { \"id\": \"int\" }",
      "STORE order FOR c1 PAYLOAD {\"id\":1}",
      "STORE order FOR c2 PAYLOAD {\"id\":2}",
      "SLEEP 200",
      "RESTART",
      "SLEEP 200",
      "QUERY order WHERE id>=1"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "c1",
        "c2"
      ]
    }
  },
  {
    "name": "wal_recover_multi_shard",
    "config": {
      "engine": {
        "fill_factor": 100,
        "shard_count": 2
      },
      "wal": {
        "enabled": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE ping FIELDS { \"x\": \"int\" }",
      "STORE ping FOR shard-a PAYLOAD {\"x\":1}",
      "STORE ping FOR shard-b PAYLOAD {\"x\":2}",
      "SLEEP 100",
      "RESTART",
      "SLEEP 100",
      "QUERY ping WHERE x>=1"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "shard-a",
        "shard-b"
      ]
    }
  },
  {
    "name": "wal_durable_flush_each_write",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "wal": {
        "enabled": true,
        "buffered": true,
        "flush_each_write": true,
        "fsync": false
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE login FIELDS { \"device\": \"string\" }",
      "STORE login FOR u1 PAYLOAD {\"device\":\"android\"}",
      "SLEEP 10",
      "RESTART",
      "SLEEP 10",
      "QUERY login WHERE device=\"android\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "u1"
      ]
    }
  },
  {
    "name": "wal_fsync_every_n_without_flush_each_write",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "wal": {
        "enabled": true,
        "buffered": true,
        "flush_each_write": false,
        "fsync": true,
        "fsync_every_n": 1
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE evt FIELDS { \"v\": \"int\" }",
      "STORE evt FOR u1 PAYLOAD {\"v\":1}",
      "SLEEP 10",
      "RESTART",
      "SLEEP 10",
      "QUERY evt WHERE v=1"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "order_by_with_lt_small_limit",
    "input_commands": [
      "DEFINE small_lt FIELDS { \"id\": \"int\" }",
      "STORE small_lt FOR a PAYLOAD {\"id\":0}",
      "STORE small_lt FOR b PAYLOAD {\"id\":1}",
      "STORE small_lt FOR c PAYLOAD {\"id\":2}",
      "FLUSH",
      "QUERY small_lt WHERE id < 10 ORDER BY id ASC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",1]",
          ",0]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "order_by_desc_with_gt_bound",
    "input_commands": [
      "DEFINE big_gt FIELDS { \"v\": \"int\" }",
      "STORE big_gt FOR g1 PAYLOAD {\"v\":100}",
      "STORE big_gt FOR g2 PAYLOAD {\"v\":200}",
      "STORE big_gt FOR g3 PAYLOAD {\"v\":300}",
      "FLUSH",
      "QUERY big_gt WHERE v > 150 ORDER BY v DESC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",300]",
          ",200]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",100]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "order_by_asc_frontier_min",
    "input_commands": [
      "DEFINE frontier FIELDS { \"score\": \"int\" }",
      "STORE frontier FOR x1 PAYLOAD {\"score\":100000}",
      "STORE frontier FOR x2 PAYLOAD {\"score\":200000}",
      "STORE frontier FOR x3 PAYLOAD {\"score\":300000}",
      "FLUSH",
      "QUERY frontier ORDER BY score ASC LIMIT 1"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"x1\","
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_asc_with_limit",
    "input_commands": [
      "DEFINE score FIELDS { \"val\": \"int\" }",
      "STORE score FOR u1 PAYLOAD {\"val\":50}",
      "STORE score FOR u2 PAYLOAD {\"val\":30}",
      "STORE score FOR u3 PAYLOAD {\"val\":70}",
      "STORE score FOR u4 PAYLOAD {\"val\":10}",
      "STORE score FOR u5 PAYLOAD {\"val\":90}",
      "FLUSH",
      "QUERY score ORDER BY val ASC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",10]",
          ",30]",
          ",50]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",70]",
          ",90]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_desc_with_limit",
    "input_commands": [
      "DEFINE score FIELDS { \"val\": \"int\" }",
      "STORE score FOR u1 PAYLOAD {\"val\":50}",
      "STORE score FOR u2 PAYLOAD {\"val\":30}",
      "STORE score FOR u3 PAYLOAD {\"val\":70}",
      "STORE score FOR u4 PAYLOAD {\"val\":10}",
      "STORE score FOR u5 PAYLOAD {\"val\":90}",
      "FLUSH",
      "QUERY score ORDER BY val DESC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",90]",
          ",70]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",50]",
          ",30]",
          ",10]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_created_at_eq_iso8601",
    "input_commands": [
      "DEFINE evt_q1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q1 FOR ctx1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_q1 FOR ctx2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "SLEEP 500",
      "QUERY evt_q1 WHERE created_at=\"2025-01-01T00:00:01Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "ctx2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_created_at_gt_seconds",
    "input_commands": [
      "DEFINE evt_q2 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q2 FOR cta PAYLOAD {\"id\":1,\"created_at\":1735689600}",
      "STORE evt_q2 FOR ctb PAYLOAD {\"id\":2,\"created_at\":1735689601}",
      "FLUSH",
      "QUERY evt_q2 WHERE created_at > 1735689600"
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "ctb"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_created_at_invalid_string_no_results",
    "input_commands": [
      "DEFINE evt_q3 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_q3 FOR cix PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "FLUSH",
      "QUERY evt_q3 WHERE created_at=\"not-a-time\""
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_date_field_eq_midnight",
    "input_commands": [
      "DEFINE people_q FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE people_q FOR pqa PAYLOAD {\"id\":1,\"on\":\"2025-09-06\"}",
      "STORE people_q FOR pqb PAYLOAD {\"id\":2,\"on\":\"2025-09-07\"}",
      "FLUSH",
      "QUERY people_q WHERE on=\"2025-09-06T00:00:00Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "pqa"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_with_offset_and_limit",
    "input_commands": [
      "DEFINE price FIELDS { \"val\": \"int\" }",
      "STORE price FOR p1 PAYLOAD {\"val\":100}",
      "STORE price FOR p2 PAYLOAD {\"val\":200}",
      "STORE price FOR p3 PAYLOAD {\"val\":300}",
      "STORE price FOR p4 PAYLOAD {\"val\":400}",
      "STORE price FOR p5 PAYLOAD {\"val\":500}",
      "FLUSH",
      "QUERY price ORDER BY val ASC OFFSET 1 LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",200]",
          ",300]",
          ",400]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",100]",
          ",500]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_desc_with_offset",
    "input_commands": [
      "DEFINE rating FIELDS { \"val\": \"int\" }",
      "STORE rating FOR r1 PAYLOAD {\"val\":5}",
      "STORE rating FOR r2 PAYLOAD {\"val\":10}",
      "STORE rating FOR r3 PAYLOAD {\"val\":15}",
      "STORE rating FOR r4 PAYLOAD {\"val\":20}",
      "STORE rating FOR r5 PAYLOAD {\"val\":25}",
      "FLUSH",
      "QUERY rating ORDER BY val DESC OFFSET 2 LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",15]",
          ",10]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",25]",
          ",20]",
          ",5]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_offset_without_limit_rejected",
    "input_commands": [
      "DEFINE evt FIELDS { \"val\": \"int\" }",
      "STORE evt FOR e1 PAYLOAD {\"val\":1}",
      "STORE evt FOR e2 PAYLOAD {\"val\":2}",
      "FLUSH",
      "QUERY evt ORDER BY val ASC OFFSET 1"
    ],
    "matcher": {
      "kind": "include",
      "value": "OFFSET requires LIMIT"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_string_field_asc",
    "input_commands": [
      "DEFINE user FIELDS { \"name\": \"string\" }",
      "STORE user FOR u1 PAYLOAD {\"name\":\"charlie\"}",
      "STORE user FOR u2 PAYLOAD {\"name\":\"alice\"}",
      "STORE user FOR u3 PAYLOAD {\"name\":\"bob\"}",
      "FLUSH",
      "QUERY user ORDER BY name ASC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "alice",
          "bob"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "charlie"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_with_filter",
    "input_commands": [
      "DEFINE item FIELDS { \"category\": \"string\", \"price\": \"int\" }",
      "STORE item FOR i1 PAYLOAD {\"category\":\"A\",\"price\":100}",
      "STORE item FOR i2 PAYLOAD {\"category\":\"A\",\"price\":200}",
      "STORE item FOR i3 PAYLOAD {\"category\":\"B\",\"price\":150}",
      "STORE item FOR i4 PAYLOAD {\"category\":\"A\",\"price\":50}",
      "FLUSH",
      "SLEEP 400",
      "QUERY item WHERE category=\"A\" ORDER BY price ASC LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",50]",
          ",100]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",200]",
          ",150]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_offset_boundary",
    "input_commands": [
      "DEFINE num FIELDS { \"val\": \"int\" }",
      "STORE num FOR n1 PAYLOAD {\"val\":1}",
      "STORE num FOR n2 PAYLOAD {\"val\":2}",
      "STORE num FOR n3 PAYLOAD {\"val\":3}",
      "FLUSH",
      "QUERY num ORDER BY val ASC OFFSET 2 LIMIT 5"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",3]"
      },
      {
        "kind": "include_none",
        "value": [
          ",1]",
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_memtable_and_segment",
    "input_commands": [
      "DEFINE mixed FIELDS { \"val\": \"int\" }",
      "STORE mixed FOR m1 PAYLOAD {\"val\":10}",
      "STORE mixed FOR m2 PAYLOAD {\"val\":20}",
      "FLUSH",
      "STORE mixed FOR m3 PAYLOAD {\"val\":5}",
      "STORE mixed FOR m4 PAYLOAD {\"val\":15}",
      "QUERY mixed ORDER BY val ASC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",5]",
          ",10]",
          ",15]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",20]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_order_by_large_offset",
    "config": {
      "engine": {
        "fill_factor": 3
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE large FIELDS { \"val\": \"int\" }",
      "STORE large FOR l1 PAYLOAD {\"val\":1}",
      "STORE large FOR l2 PAYLOAD {\"val\":2}",
      "STORE large FOR l3 PAYLOAD {\"val\":3}",
      "STORE large FOR l4 PAYLOAD {\"val\":4}",
      "STORE large FOR l5 PAYLOAD {\"val\":5}",
      "STORE large FOR l6 PAYLOAD {\"val\":6}",
      "FLUSH",
      "SLEEP 500",
      "QUERY large ORDER BY val ASC OFFSET 4 LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",5]",
          ",6]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",1]",
          ",2]",
          ",3]",
          ",4]"
        ]
      }
    ]
  },
  {
    "name": "created_at_between_inclusive_and_exclusive",
    "input_commands": [
      "DEFINE evt_between_1 FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_between_1 FOR ba PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_between_1 FOR bb PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_between_1 WHERE created_at >= \"2025-01-01T00:00:00Z\" AND created_at < \"2025-01-01T00:00:01Z\"",
      "QUERY evt_between_1 WHERE created_at > \"2025-01-01T00:00:00Z\" AND created_at <= \"2025-01-01T00:00:01Z\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ba"
        ]
      },
      {
        "kind": "include_all",
        "value": [
          "bb"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "created_at_seconds_range",
    "input_commands": [
      "DEFINE evt_frac FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_frac FOR f1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_frac FOR f2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_frac WHERE created_at >= \"2025-01-01T00:00:01Z\" AND created_at < \"2025-01-01T00:00:02Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "f2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "created_at_tz_plus00_equivalent_to_z",
    "input_commands": [
      "DEFINE evt_tz_eq FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_tz_eq FOR tzZ PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00+00:00\"}",
      "FLUSH",
      "QUERY evt_tz_eq WHERE created_at=\"2025-01-01T00:00:00Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "tzZ"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "date_field_leap_day_eq",
    "input_commands": [
      "DEFINE birthdays_lp FIELDS { \"id\": \"int\", \"on\": \"date\" }",
      "STORE birthdays_lp FOR lp1 PAYLOAD {\"id\":1,\"on\":\"2024-02-29\"}",
      "FLUSH",
      "QUERY birthdays_lp WHERE on=\"2024-02-29T00:00:00Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "lp1"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_using_created_at_us_input_inclusive",
    "input_commands": [
      "DEFINE evt_us FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_us FOR us1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_us FOR us2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_us FOR us1 SINCE \"1735689600000000\" USING created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",1]"
      },
      {
        "kind": "include_none",
        "value": [
          ",2]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "created_at_less_than_boundary_excludes_equal",
    "input_commands": [
      "DEFINE evt_lt FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_lt FOR l1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_lt FOR l2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_lt WHERE created_at < \"2025-01-01T00:00:01Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "l1"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "created_at_or_two_values",
    "input_commands": [
      "DEFINE evt_or FIELDS { \"id\": \"int\", \"created_at\": \"datetime\" }",
      "STORE evt_or FOR o1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_or FOR o2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_or WHERE created_at=\"2025-01-01T00:00:00Z\" OR created_at=\"2025-01-01T00:00:01Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "o1",
        "o2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "since_on_date_field_and_where_on_datetime",
    "input_commands": [
      "DEFINE evt_mixed_time FIELDS { \"id\": \"int\", \"on\": \"date\", \"created_at\": \"datetime\" }",
      "STORE evt_mixed_time FOR mx1 PAYLOAD {\"id\":1,\"on\":\"2025-01-01\",\"created_at\":\"2025-01-01T00:00:00Z\"}",
      "STORE evt_mixed_time FOR mx2 PAYLOAD {\"id\":2,\"on\":\"2025-01-02\",\"created_at\":\"2025-01-02T00:00:01Z\"}",
      "FLUSH",
      "QUERY evt_mixed_time SINCE \"2025-01-02T00:00:00Z\" USING on WHERE created_at=\"2025-01-02T00:00:01Z\""
    ],
    "matcher": {
      "kind": "include_all",
      "value": [
        "mx2"
      ]
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "streaming_memtable_basic",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE streaming_basic FIELDS { \"value\": \"int\" }",
      "STORE streaming_basic FOR mem-1 PAYLOAD {\"value\":1}",
      "STORE streaming_basic FOR mem-2 PAYLOAD {\"value\":2}",
      "QUERY streaming_basic WHERE value >= 0"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mem-1",
          "mem-2"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "streaming_segment_and_memtable",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE streaming_mix FIELDS { \"value\": \"int\" }",
      "STORE streaming_mix FOR seg-ctx PAYLOAD {\"value\":1}",
      "STORE streaming_mix FOR seg-ctx2 PAYLOAD {\"value\":2}",
      "FLUSH",
      "STORE streaming_mix FOR mem-ctx PAYLOAD {\"value\":3}",
      "QUERY streaming_mix WHERE value >= 0"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "seg-ctx",
          "seg-ctx2",
          "mem-ctx"
        ]
      }
    ]
  },
  {
    "name": "streaming_limit_offset",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE streaming_limit FIELDS { \"value\": \"int\" }",
      "STORE streaming_limit FOR ctx-1 PAYLOAD {\"value\":10}",
      "STORE streaming_limit FOR ctx-2 PAYLOAD {\"value\":20}",
      "STORE streaming_limit FOR ctx-3 PAYLOAD {\"value\":30}",
      "STORE streaming_limit FOR ctx-4 PAYLOAD {\"value\":40}",
      "QUERY streaming_limit WHERE value >= 0 OFFSET 1 LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx-2",
          "ctx-3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx-1",
          "ctx-4"
        ]
      },
      {
        "kind": "include",
        "value": "\"row_count\":2"
      }
    ]
  },
  {
    "name": "streaming_order_by_limit",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE streaming_order FIELDS { \"value\": \"int\" }",
      "STORE streaming_order FOR seg-1 PAYLOAD {\"value\":30}",
      "STORE streaming_order FOR seg-2 PAYLOAD {\"value\":10}",
      "FLUSH",
      "STORE streaming_order FOR mem-1 PAYLOAD {\"value\":20}",
      "STORE streaming_order FOR mem-2 PAYLOAD {\"value\":40}",
      "QUERY streaming_order ORDER BY value ASC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "regex",
        "value": "seg-2(?s).*mem-1(?s).*seg-1"
      }
    ]
  },
  {
    "name": "sequence_followed_by_basic",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_where_clause",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_preceded_by_basic",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"amount\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"amount\":100}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_preceded_by_with_where_clause",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"amount\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"amount\":100}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE payment_failed FOR u2 PAYLOAD {\"user_id\":\"u2\",\"amount\":200}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id WHERE order_created.status=\"done\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_no_match",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_out_of_order",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_multiple_users",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"checkout\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2",
          "u3"
        ]
      }
    ]
  },
  {
    "name": "sequence_linked_by_order_id",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "DEFINE order_cancelled FIELDS { \"order_id\": \"int\", \"reason\": \"string\" }",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_cancelled FOR u1 PAYLOAD {\"order_id\":1,\"reason\":\"changed_mind\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY order_created FOLLOWED BY order_cancelled LINKED BY order_id"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "1,\"u1\""
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "2,\"u2\""
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_common_where",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"timestamp\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"timestamp\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\",\"timestamp\":1000}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"timestamp\":2000}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\",\"timestamp\":3000}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"timestamp\":4000}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE timestamp > 500"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_and_where",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\" AND order_created.status=\"done\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_preceded_by_multiple_events",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"attempt\": \"int\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"attempt\":1}",
      "SLEEP 1000",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"attempt\":2}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_limit",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page=\"/checkout\" LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "u1"
      },
      {
        "kind": "include",
        "value": "u2"
      },
      {
        "kind": "include_none",
        "value": [
          "u3"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_same_timestamp",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\", \"created_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\", \"created_at\":\"2025-01-01T10:00:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id USING TIME created_at"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "u1"
      },
      {
        "kind": "include",
        "value": "page_view"
      },
      {
        "kind": "include",
        "value": "order_created"
      }
    ]
  },
  {
    "name": "sequence_followed_by_different_link_values",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":1,\"user_id\":\"u2\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    }
  },
  {
    "name": "sequence_followed_by_with_numeric_link_field",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"customer_id\": \"int\" }",
      "DEFINE order_shipped FIELDS { \"order_id\": \"int\", \"customer_id\": \"int\" }",
      "STORE order_created FOR c1 PAYLOAD {\"order_id\":1,\"customer_id\":100}",
      "SLEEP 1000",
      "STORE order_shipped FOR c1 PAYLOAD {\"order_id\":1,\"customer_id\":100}",
      "STORE order_created FOR c2 PAYLOAD {\"order_id\":2,\"customer_id\":200}",
      "FLUSH",
      "QUERY order_created FOLLOWED BY order_shipped LINKED BY customer_id"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",100,1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",200,1"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field_and_where",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\", \"amount\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\",\"amount\":100}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\",\"amount\":50}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at WHERE purchase.amount > 75"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_followed_by_with_time_field_and_limit",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:05:00Z\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:00:00Z\"}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"viewed_at\":\"2025-01-01T11:10:00Z\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u3\",\"viewed_at\":\"2025-01-01T12:00:00Z\"}",
      "STORE purchase FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"viewed_at\":\"2025-01-01T12:15:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at LIMIT 2"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "u1"
      },
      {
        "kind": "include",
        "value": "u2"
      },
      {
        "kind": "include_none",
        "value": [
          "u3"
        ]
      }
    ]
  },
  {
    "name": "sequence_preceded_by_with_time_field",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE payment_failed FIELDS { \"user_id\": \"string\", \"failed_at\": \"datetime\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"created_at\": \"datetime\" }",
      "STORE payment_failed FOR u1 PAYLOAD {\"user_id\":\"u1\",\"failed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"created_at\":\"2025-01-01T10:30:00Z\"}",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"created_at\":\"2025-01-01T11:00:00Z\"}",
      "FLUSH",
      "QUERY order_created PRECEDED BY payment_failed LINKED BY user_id USING TIME created_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_with_time_field_numeric_timestamp",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"ts\": \"int\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"ts\": \"int\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"ts\":1735689600}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"ts\":1735689900}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u2\",\"ts\":1735690000}",
      "STORE purchase FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"ts\":1735690300}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME ts"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      }
    ]
  },
  {
    "name": "sequence_with_different_time_fields",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\", \"viewed_at\": \"datetime\" }",
      "DEFINE purchase FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"viewed_at\": \"datetime\", \"purchased_at\": \"datetime\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u1\",\"viewed_at\":\"2025-01-01T10:00:00Z\"}",
      "STORE purchase FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"purchased_at\":\"2025-01-01T13:05:00Z\",\"viewed_at\":\"2025-01-01T12:00:00Z\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY purchase LINKED BY user_id USING TIME viewed_at"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      }
    ]
  },
  {
    "name": "query_in_operator_numeric_basic",
    "input_commands": [
      "DEFINE in_numeric FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_numeric FOR ctx1 PAYLOAD {\"id\":1,\"value\":10}",
      "STORE in_numeric FOR ctx2 PAYLOAD {\"id\":2,\"value\":20}",
      "STORE in_numeric FOR ctx3 PAYLOAD {\"id\":3,\"value\":30}",
      "STORE in_numeric FOR ctx4 PAYLOAD {\"id\":4,\"value\":40}",
      "STORE in_numeric FOR ctx5 PAYLOAD {\"id\":5,\"value\":50}",
      "FLUSH",
      "QUERY in_numeric WHERE id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx2",
          "ctx4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx3",
          "ctx5"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_string_basic",
    "input_commands": [
      "DEFINE in_string FIELDS { \"status\": \"string\", \"value\": \"int\" }",
      "STORE in_string FOR s1 PAYLOAD {\"status\":\"pending\",\"value\":10}",
      "STORE in_string FOR s2 PAYLOAD {\"status\":\"active\",\"value\":20}",
      "STORE in_string FOR s3 PAYLOAD {\"status\":\"completed\",\"value\":30}",
      "STORE in_string FOR s4 PAYLOAD {\"status\":\"cancelled\",\"value\":40}",
      "FLUSH",
      "QUERY in_string WHERE status IN (\"active\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "s2",
          "s3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "s1",
          "s4"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_single_value",
    "input_commands": [
      "DEFINE in_single FIELDS { \"id\": \"int\" }",
      "STORE in_single FOR v1 PAYLOAD {\"id\":1}",
      "STORE in_single FOR v2 PAYLOAD {\"id\":2}",
      "STORE in_single FOR v3 PAYLOAD {\"id\":3}",
      "FLUSH",
      "QUERY in_single WHERE id IN (2)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "v2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "v1",
          "v3"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_no_matches",
    "input_commands": [
      "DEFINE in_no_match FIELDS { \"id\": \"int\" }",
      "STORE in_no_match FOR n1 PAYLOAD {\"id\":1}",
      "STORE in_no_match FOR n2 PAYLOAD {\"id\":2}",
      "STORE in_no_match FOR n3 PAYLOAD {\"id\":3}",
      "FLUSH",
      "QUERY in_no_match WHERE id IN (10, 20, 30)"
    ],
    "matcher": {
      "kind": "include",
      "value": "\"row_count\":0"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_with_and",
    "input_commands": [
      "DEFINE in_and FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE in_and FOR a1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE in_and FOR a2 PAYLOAD {\"id\":2,\"status\":\"active\"}",
      "STORE in_and FOR a3 PAYLOAD {\"id\":3,\"status\":\"inactive\"}",
      "STORE in_and FOR a4 PAYLOAD {\"id\":4,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_and WHERE id IN (2, 4, 6) AND status=\"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "a2",
          "a4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "a1",
          "a3"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_with_or",
    "input_commands": [
      "DEFINE in_or FIELDS { \"id\": \"int\", \"category\": \"string\" }",
      "STORE in_or FOR o1 PAYLOAD {\"id\":1,\"category\":\"A\"}",
      "STORE in_or FOR o2 PAYLOAD {\"id\":2,\"category\":\"A\"}",
      "STORE in_or FOR o3 PAYLOAD {\"id\":3,\"category\":\"A\"}",
      "STORE in_or FOR o4 PAYLOAD {\"id\":6,\"category\":\"B\"}",
      "STORE in_or FOR o5 PAYLOAD {\"id\":7,\"category\":\"B\"}",
      "FLUSH",
      "QUERY in_or WHERE id IN (1, 2, 3) OR category=\"B\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "o1",
          "o2",
          "o3",
          "o4",
          "o5"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_with_not",
    "input_commands": [
      "DEFINE in_not FIELDS { \"id\": \"int\" }",
      "STORE in_not FOR n1 PAYLOAD {\"id\":1}",
      "STORE in_not FOR n2 PAYLOAD {\"id\":2}",
      "STORE in_not FOR n3 PAYLOAD {\"id\":3}",
      "STORE in_not FOR n4 PAYLOAD {\"id\":4}",
      "STORE in_not FOR n5 PAYLOAD {\"id\":5}",
      "FLUSH",
      "QUERY in_not WHERE NOT id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "n1",
          "n3",
          "n5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "n2",
          "n4"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_with_order_by_limit",
    "input_commands": [
      "DEFINE in_order FIELDS { \"id\": \"int\", \"score\": \"int\" }",
      "STORE in_order FOR ord1 PAYLOAD {\"id\":2,\"score\":20}",
      "STORE in_order FOR ord2 PAYLOAD {\"id\":5,\"score\":50}",
      "STORE in_order FOR ord3 PAYLOAD {\"id\":8,\"score\":80}",
      "STORE in_order FOR ord4 PAYLOAD {\"id\":1,\"score\":10}",
      "STORE in_order FOR ord5 PAYLOAD {\"id\":9,\"score\":90}",
      "FLUSH",
      "QUERY in_order WHERE id IN (2, 5, 8, 1, 9) ORDER BY score DESC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          ",90]",
          ",80]",
          ",50]"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          ",20]",
          ",10]"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_with_aggregation",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_agg FIELDS { \"region\": \"string\", \"amount\": \"int\" }",
      "STORE in_agg FOR agg1 PAYLOAD {\"region\":\"US\",\"amount\":10}",
      "STORE in_agg FOR agg2 PAYLOAD {\"region\":\"EU\",\"amount\":20}",
      "STORE in_agg FOR agg3 PAYLOAD {\"region\":\"ASIA\",\"amount\":30}",
      "STORE in_agg FOR agg4 PAYLOAD {\"region\":\"US\",\"amount\":40}",
      "STORE in_agg FOR agg5 PAYLOAD {\"region\":\"EU\",\"amount\":50}",
      "FLUSH",
      "QUERY in_agg WHERE region IN (\"US\", \"EU\") COUNT, TOTAL amount BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"US\",2,50"
      },
      {
        "kind": "include",
        "value": "\"EU\",2,70"
      },
      {
        "kind": "include_none",
        "value": [
          "ASIA"
        ]
      }
    ]
  },
  {
    "name": "query_in_operator_negative_numbers",
    "input_commands": [
      "DEFINE in_neg FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_neg FOR neg1 PAYLOAD {\"id\":-5,\"value\":10}",
      "STORE in_neg FOR neg2 PAYLOAD {\"id\":-3,\"value\":20}",
      "STORE in_neg FOR neg3 PAYLOAD {\"id\":0,\"value\":30}",
      "STORE in_neg FOR neg4 PAYLOAD {\"id\":2,\"value\":40}",
      "STORE in_neg FOR neg5 PAYLOAD {\"id\":4,\"value\":50}",
      "FLUSH",
      "QUERY in_neg WHERE id IN (-3, -1, 0, 2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "neg2",
          "neg3",
          "neg4",
          "neg5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "neg1"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_in_operator_memtable_only",
    "config": {
      "engine": {
        "fill_factor": 100
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_mem FIELDS { \"id\": \"int\" }",
      "STORE in_mem FOR mem1 PAYLOAD {\"id\":1}",
      "STORE in_mem FOR mem2 PAYLOAD {\"id\":2}",
      "STORE in_mem FOR mem3 PAYLOAD {\"id\":3}",
      "STORE in_mem FOR mem4 PAYLOAD {\"id\":4}",
      "QUERY in_mem WHERE id IN (2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mem2",
          "mem4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mem1",
          "mem3"
        ]
      }
    ]
  },
  {
    "name": "query_in_operator_numeric_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_stream_num FIELDS { \"id\": \"int\", \"value\": \"int\" }",
      "STORE in_stream_num FOR s1 PAYLOAD {\"id\":1,\"value\":10}",
      "STORE in_stream_num FOR s2 PAYLOAD {\"id\":2,\"value\":20}",
      "STORE in_stream_num FOR s3 PAYLOAD {\"id\":3,\"value\":30}",
      "STORE in_stream_num FOR s4 PAYLOAD {\"id\":4,\"value\":40}",
      "STORE in_stream_num FOR s5 PAYLOAD {\"id\":5,\"value\":50}",
      "FLUSH",
      "QUERY in_stream_num WHERE id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "s2",
          "s4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "s1",
          "s3",
          "s5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_string_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_stream_str FIELDS { \"status\": \"string\", \"priority\": \"int\" }",
      "STORE in_stream_str FOR str1 PAYLOAD {\"status\":\"pending\",\"priority\":1}",
      "STORE in_stream_str FOR str2 PAYLOAD {\"status\":\"active\",\"priority\":2}",
      "STORE in_stream_str FOR str3 PAYLOAD {\"status\":\"completed\",\"priority\":3}",
      "STORE in_stream_str FOR str4 PAYLOAD {\"status\":\"cancelled\",\"priority\":4}",
      "FLUSH",
      "QUERY in_stream_str WHERE status IN (\"active\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "str2",
          "str3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "str1",
          "str4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_and_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_and_stream FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE in_and_stream FOR as1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE in_and_stream FOR as2 PAYLOAD {\"id\":2,\"status\":\"active\"}",
      "STORE in_and_stream FOR as3 PAYLOAD {\"id\":3,\"status\":\"inactive\"}",
      "STORE in_and_stream FOR as4 PAYLOAD {\"id\":4,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_and_stream WHERE id IN (2, 4, 6) AND status=\"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "as2",
          "as4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "as1",
          "as3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_not_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_not_stream FIELDS { \"id\": \"int\" }",
      "STORE in_not_stream FOR ns1 PAYLOAD {\"id\":1}",
      "STORE in_not_stream FOR ns2 PAYLOAD {\"id\":2}",
      "STORE in_not_stream FOR ns3 PAYLOAD {\"id\":3}",
      "STORE in_not_stream FOR ns4 PAYLOAD {\"id\":4}",
      "STORE in_not_stream FOR ns5 PAYLOAD {\"id\":5}",
      "FLUSH",
      "QUERY in_not_stream WHERE NOT id IN (2, 4, 6)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ns1",
          "ns3",
          "ns5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ns2",
          "ns4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_order_by_limit_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_order_stream FIELDS { \"id\": \"int\", \"score\": \"int\" }",
      "STORE in_order_stream FOR os1 PAYLOAD {\"id\":2,\"score\":20}",
      "STORE in_order_stream FOR os2 PAYLOAD {\"id\":5,\"score\":50}",
      "STORE in_order_stream FOR os3 PAYLOAD {\"id\":8,\"score\":80}",
      "STORE in_order_stream FOR os4 PAYLOAD {\"id\":1,\"score\":10}",
      "STORE in_order_stream FOR os5 PAYLOAD {\"id\":9,\"score\":90}",
      "FLUSH",
      "QUERY in_order_stream WHERE id IN (2, 5, 8, 1, 9) ORDER BY score DESC LIMIT 3"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "os5",
          "os3",
          "os2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "os1",
          "os4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_memtable_and_segment_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_mix_stream FIELDS { \"id\": \"int\" }",
      "STORE in_mix_stream FOR seg1 PAYLOAD {\"id\":1}",
      "STORE in_mix_stream FOR seg2 PAYLOAD {\"id\":2}",
      "FLUSH",
      "STORE in_mix_stream FOR mem1 PAYLOAD {\"id\":3}",
      "STORE in_mix_stream FOR mem2 PAYLOAD {\"id\":4}",
      "QUERY in_mix_stream WHERE id IN (2, 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "seg2",
          "mem2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "seg1",
          "mem1"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_or_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_or_stream FIELDS { \"id\": \"int\", \"category\": \"string\" }",
      "STORE in_or_stream FOR ors1 PAYLOAD {\"id\":1,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors2 PAYLOAD {\"id\":2,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors3 PAYLOAD {\"id\":3,\"category\":\"A\"}",
      "STORE in_or_stream FOR ors4 PAYLOAD {\"id\":6,\"category\":\"B\"}",
      "STORE in_or_stream FOR ors5 PAYLOAD {\"id\":7,\"category\":\"B\"}",
      "FLUSH",
      "QUERY in_or_stream WHERE id IN (1, 2, 3) OR category=\"B\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ors1",
          "ors2",
          "ors3",
          "ors4",
          "ors5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_sequence_followed_by_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"done\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"status\":\"pending\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE order_created.status IN (\"done\", \"completed\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u2"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u3"
        ]
      }
    ]
  },
  {
    "name": "query_in_operator_sequence_with_event_specific_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/product\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page IN (\"/checkout\", \"/product\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1",
          "u3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2"
        ]
      }
    ]
  },
  {
    "name": "query_in_operator_multiple_in_clauses_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE multi_in FIELDS { \"id\": \"int\", \"status\": \"string\", \"region\": \"string\" }",
      "STORE multi_in FOR mi1 PAYLOAD {\"id\":1,\"status\":\"active\",\"region\":\"US\"}",
      "STORE multi_in FOR mi2 PAYLOAD {\"id\":2,\"status\":\"active\",\"region\":\"EU\"}",
      "STORE multi_in FOR mi3 PAYLOAD {\"id\":3,\"status\":\"pending\",\"region\":\"US\"}",
      "STORE multi_in FOR mi4 PAYLOAD {\"id\":4,\"status\":\"active\",\"region\":\"ASIA\"}",
      "STORE multi_in FOR mi5 PAYLOAD {\"id\":5,\"status\":\"completed\",\"region\":\"EU\"}",
      "FLUSH",
      "QUERY multi_in WHERE id IN (1, 2, 3) AND status IN (\"active\", \"pending\") AND region IN (\"US\", \"EU\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mi1",
          "mi2",
          "mi3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mi4",
          "mi5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_temporal_field_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_temporal FIELDS { \"id\": \"int\", \"created_at\": \"datetime\", \"status\": \"string\" }",
      "STORE in_temporal FOR t1 PAYLOAD {\"id\":1,\"created_at\":\"2025-01-01T00:00:00Z\",\"status\":\"active\"}",
      "STORE in_temporal FOR t2 PAYLOAD {\"id\":2,\"created_at\":\"2025-01-01T00:00:01Z\",\"status\":\"active\"}",
      "STORE in_temporal FOR t3 PAYLOAD {\"id\":3,\"created_at\":\"2025-01-01T00:00:02Z\",\"status\":\"pending\"}",
      "STORE in_temporal FOR t4 PAYLOAD {\"id\":4,\"created_at\":\"2025-01-01T00:00:03Z\",\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_temporal WHERE created_at IN (\"2025-01-01T00:00:00Z\", \"2025-01-01T00:00:02Z\", \"2025-01-01T00:00:04Z\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "t1",
          "t3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "t2",
          "t4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_complex_and_or_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE complex_in FIELDS { \"id\": \"int\", \"category\": \"string\", \"priority\": \"int\" }",
      "STORE complex_in FOR c1 PAYLOAD {\"id\":1,\"category\":\"A\",\"priority\":1}",
      "STORE complex_in FOR c2 PAYLOAD {\"id\":2,\"category\":\"B\",\"priority\":2}",
      "STORE complex_in FOR c3 PAYLOAD {\"id\":3,\"category\":\"A\",\"priority\":3}",
      "STORE complex_in FOR c4 PAYLOAD {\"id\":4,\"category\":\"C\",\"priority\":1}",
      "STORE complex_in FOR c5 PAYLOAD {\"id\":5,\"category\":\"B\",\"priority\":3}",
      "FLUSH",
      "QUERY complex_in WHERE (id IN (1, 2, 3) AND category IN (\"A\", \"B\")) OR priority IN (3)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "c1",
          "c2",
          "c3",
          "c5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "c4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_with_aggregation_group_by_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE in_agg_group FIELDS { \"region\": \"string\", \"amount\": \"int\", \"status\": \"string\" }",
      "STORE in_agg_group FOR ag1 PAYLOAD {\"region\":\"US\",\"amount\":10,\"status\":\"active\"}",
      "STORE in_agg_group FOR ag2 PAYLOAD {\"region\":\"US\",\"amount\":20,\"status\":\"pending\"}",
      "STORE in_agg_group FOR ag3 PAYLOAD {\"region\":\"EU\",\"amount\":30,\"status\":\"active\"}",
      "STORE in_agg_group FOR ag4 PAYLOAD {\"region\":\"EU\",\"amount\":40,\"status\":\"completed\"}",
      "STORE in_agg_group FOR ag5 PAYLOAD {\"region\":\"ASIA\",\"amount\":50,\"status\":\"active\"}",
      "FLUSH",
      "QUERY in_agg_group WHERE status IN (\"active\", \"pending\") COUNT, AVG amount BY region"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"US\",2,15.0"
      },
      {
        "kind": "include",
        "value": "\"EU\",1,30.0"
      },
      {
        "kind": "include",
        "value": "\"ASIA\",1,50.0"
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_in_operator_sequence_with_in_and_not_streaming",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE page_view FIELDS { \"page\": \"string\", \"user_id\": \"string\" }",
      "DEFINE order_created FIELDS { \"order_id\": \"int\", \"user_id\": \"string\", \"status\": \"string\" }",
      "STORE page_view FOR u1 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u1\"}",
      "SLEEP 1000",
      "STORE order_created FOR u1 PAYLOAD {\"order_id\":1,\"user_id\":\"u1\",\"status\":\"done\"}",
      "STORE page_view FOR u2 PAYLOAD {\"page\":\"/checkout\",\"user_id\":\"u2\"}",
      "SLEEP 1000",
      "STORE order_created FOR u2 PAYLOAD {\"order_id\":2,\"user_id\":\"u2\",\"status\":\"pending\"}",
      "STORE page_view FOR u3 PAYLOAD {\"page\":\"/home\",\"user_id\":\"u3\"}",
      "SLEEP 1000",
      "STORE order_created FOR u3 PAYLOAD {\"order_id\":3,\"user_id\":\"u3\",\"status\":\"done\"}",
      "FLUSH",
      "QUERY page_view FOLLOWED BY order_created LINKED BY user_id WHERE page_view.page IN (\"/checkout\", \"/product\") AND NOT order_created.status IN (\"pending\", \"cancelled\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "u1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "u2",
          "u3"
        ]
      }
    ]
  },
  {
    "name": "query_parentheses_with_or_and_and",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE paren_or_and FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE paren_or_and FOR ctx1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE paren_or_and FOR ctx2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE paren_or_and FOR ctx3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE paren_or_and FOR ctx4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "STORE paren_or_and FOR ctx5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":6}",
      "FLUSH",
      "QUERY paren_or_and WHERE (status = \"active\" OR status = \"pending\") AND priority > 5"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx1",
          "ctx2",
          "ctx4",
          "ctx5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_nested_or_and",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE nested_paren FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE nested_paren FOR n1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE nested_paren FOR n2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE nested_paren FOR n3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE nested_paren FOR n4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6}",
      "STORE nested_paren FOR n5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":4}",
      "FLUSH",
      "QUERY nested_paren WHERE (status = \"active\" OR status = \"pending\") AND (priority > 4 OR priority < 2)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "n2",
          "n3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "n1",
          "n4",
          "n5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_or_different_fields",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE diff_fields FIELDS { \"id\": \"int\", \"status\": \"string\", \"category\": \"string\" }",
      "STORE diff_fields FOR d1 PAYLOAD {\"id\":1,\"status\":\"active\",\"category\":\"A\"}",
      "STORE diff_fields FOR d2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"category\":\"B\"}",
      "STORE diff_fields FOR d3 PAYLOAD {\"id\":3,\"status\":\"completed\",\"category\":\"A\"}",
      "STORE diff_fields FOR d4 PAYLOAD {\"id\":4,\"status\":\"active\",\"category\":\"C\"}",
      "FLUSH",
      "QUERY diff_fields WHERE (status = \"active\" OR category = \"B\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "d1",
          "d2",
          "d4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "d3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_triple_nested",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE triple_nest FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\", \"category\": \"string\" }",
      "STORE triple_nest FOR t1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3,\"category\":\"A\"}",
      "STORE triple_nest FOR t2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5,\"category\":\"B\"}",
      "STORE triple_nest FOR t3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7,\"category\":\"A\"}",
      "STORE triple_nest FOR t4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6,\"category\":\"B\"}",
      "FLUSH",
      "QUERY triple_nest WHERE ((status = \"active\" OR status = \"pending\") AND priority > 4) OR category = \"A\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "t1",
          "t2",
          "t3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "t4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_with_in_operator",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE paren_in FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE paren_in FOR pi1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE paren_in FOR pi2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE paren_in FOR pi3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE paren_in FOR pi4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY paren_in WHERE (id IN (1, 2, 3) AND status = \"active\") OR priority > 6"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "pi1",
          "pi3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "pi2",
          "pi4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_multiple_and_or",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE multi_and_or FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\", \"category\": \"string\" }",
      "STORE multi_and_or FOR m1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3,\"category\":\"A\"}",
      "STORE multi_and_or FOR m2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5,\"category\":\"B\"}",
      "STORE multi_and_or FOR m3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7,\"category\":\"A\"}",
      "STORE multi_and_or FOR m4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6,\"category\":\"B\"}",
      "STORE multi_and_or FOR m5 PAYLOAD {\"id\":5,\"status\":\"cancelled\",\"priority\":4,\"category\":\"C\"}",
      "FLUSH",
      "QUERY multi_and_or WHERE (status = \"active\" OR status = \"pending\") AND (priority > 4 OR category = \"A\")"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "m1",
          "m2",
          "m3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "m4",
          "m5"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_with_not_and_or",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE not_paren FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_paren FOR np1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_paren FOR np2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE not_paren FOR np3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE not_paren FOR np4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY not_paren WHERE NOT (status = \"active\" OR status = \"pending\") AND priority > 1"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "np4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "np1",
          "np2",
          "np3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_not_with_and_de_morgan",
    "input_commands": [
      "DEFINE not_and FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_and FOR na1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_and FOR na2 PAYLOAD {\"id\":2,\"status\":\"active\",\"priority\":5}",
      "STORE not_and FOR na3 PAYLOAD {\"id\":3,\"status\":\"pending\",\"priority\":3}",
      "STORE not_and FOR na4 PAYLOAD {\"id\":4,\"status\":\"pending\",\"priority\":5}",
      "FLUSH",
      "QUERY not_and WHERE NOT (status = \"active\" AND priority > 4)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "na1",
          "na3",
          "na4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "na2"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_double_negation",
    "input_commands": [
      "DEFINE double_not FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE double_not FOR dn1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE double_not FOR dn2 PAYLOAD {\"id\":2,\"status\":\"pending\"}",
      "STORE double_not FOR dn3 PAYLOAD {\"id\":3,\"status\":\"completed\"}",
      "FLUSH",
      "QUERY double_not WHERE NOT NOT status = \"active\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "dn1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "dn2",
          "dn3"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_parentheses_with_not_and_or_non_streaming",
    "input_commands": [
      "DEFINE not_paren_ns FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE not_paren_ns FOR np1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE not_paren_ns FOR np2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE not_paren_ns FOR np3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE not_paren_ns FOR np4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":2}",
      "FLUSH",
      "QUERY not_paren_ns WHERE NOT (status = \"active\" OR status = \"pending\") AND priority > 1"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "np4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "np1",
          "np2",
          "np3"
        ]
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "query_parentheses_deeply_nested",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE deep_nest FIELDS { \"id\": \"int\", \"status\": \"string\", \"priority\": \"int\" }",
      "STORE deep_nest FOR dn1 PAYLOAD {\"id\":1,\"status\":\"active\",\"priority\":3}",
      "STORE deep_nest FOR dn2 PAYLOAD {\"id\":2,\"status\":\"pending\",\"priority\":5}",
      "STORE deep_nest FOR dn3 PAYLOAD {\"id\":3,\"status\":\"active\",\"priority\":7}",
      "STORE deep_nest FOR dn4 PAYLOAD {\"id\":4,\"status\":\"completed\",\"priority\":6}",
      "FLUSH",
      "QUERY deep_nest WHERE ((status = \"active\" OR status = \"pending\") AND priority > 4) OR (status = \"completed\" AND priority > 5)"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "dn2",
          "dn3",
          "dn4"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "dn1"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "query_parentheses_or_same_field_multiple_values",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE multi_or FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE multi_or FOR mo1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE multi_or FOR mo2 PAYLOAD {\"id\":2,\"status\":\"pending\"}",
      "STORE multi_or FOR mo3 PAYLOAD {\"id\":3,\"status\":\"completed\"}",
      "STORE multi_or FOR mo4 PAYLOAD {\"id\":4,\"status\":\"cancelled\"}",
      "STORE multi_or FOR mo5 PAYLOAD {\"id\":5,\"status\":\"active\"}",
      "FLUSH",
      "QUERY multi_or WHERE status = \"active\" OR status = \"pending\" OR status = \"completed\""
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "mo1",
          "mo2",
          "mo3",
          "mo5"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "mo4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "auth_create_user_and_list",
    "input_commands": [
      "CREATE USER testuser",
      "LIST USERS"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "User 'testuser' created"
      },
      {
        "kind": "include",
        "value": "Secret key:"
      },
      {
        "kind": "include",
        "value": "testuser: active"
      }
    ],
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "auth_bypass_enabled_allows_unauthenticated_commands",
    "config": {
      "auth": {
        "bypass_auth": true
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE auth_test FIELDS { \"value\": \"int\" }",
      "STORE auth_test FOR ctx1 PAYLOAD {\"value\":42}",
      "QUERY auth_test WHERE value=42"
    ],
    "matchers": [
      {
        "kind": "include_all",
        "value": [
          "ctx1",
          "42"
        ]
      }
    ]
  },
  {
    "name": "auth_bypass_disabled_requires_authentication",
    "config": {
      "auth": {
        "bypass_auth": false
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE auth_required FIELDS { \"value\": \"int\" }",
      "STORE auth_required FOR ctx1 PAYLOAD {\"value\":42}"
    ],
    "matcher": {
      "kind": "include",
      "value": "Authentication failed"
    }
  },
  {
    "name": "remember_basic_query",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\", \"amount\": \"int\" }",
      "STORE orders FOR c1 PAYLOAD {\"order_id\":1,\"status\":\"confirmed\",\"amount\":100}",
      "STORE orders FOR c2 PAYLOAD {\"order_id\":2,\"status\":\"pending\",\"amount\":200}",
      "STORE orders FOR c3 PAYLOAD {\"order_id\":3,\"status\":\"confirmed\",\"amount\":150}",
      "FLUSH",
      "REMEMBER QUERY orders AS recent_orders"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "remembered query 'recent_orders'"
      },
      {
        "kind": "include",
        "value": "rows stored: 3"
      }
    ]
  },
  {
    "name": "remember_query_with_where_clause",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE products FIELDS { \"product_id\": \"int\", \"category\": \"string\", \"price\": \"int\" }",
      "STORE products FOR p1 PAYLOAD {\"product_id\":1,\"category\":\"electronics\",\"price\":500}",
      "STORE products FOR p2 PAYLOAD {\"product_id\":2,\"category\":\"clothing\",\"price\":50}",
      "STORE products FOR p3 PAYLOAD {\"product_id\":3,\"category\":\"electronics\",\"price\":300}",
      "FLUSH",
      "REMEMBER QUERY products WHERE category=\"electronics\" AS electronics_only"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "remembered query 'electronics_only'"
      },
      {
        "kind": "include",
        "value": "rows stored: 2"
      }
    ]
  },
  {
    "name": "remember_query_with_return_fields",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE users FIELDS { \"user_id\": \"int\", \"name\": \"string\", \"email\": \"string\", \"age\": \"int\" }",
      "STORE users FOR u1 PAYLOAD {\"user_id\":1,\"name\":\"Alice\",\"email\":\"alice@example.com\",\"age\":30}",
      "STORE users FOR u2 PAYLOAD {\"user_id\":2,\"name\":\"Bob\",\"email\":\"bob@example.com\",\"age\":25}",
      "FLUSH",
      "REMEMBER QUERY users RETURN [user_id, name] AS user_names"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "remembered query 'user_names'"
      },
      {
        "kind": "include",
        "value": "rows stored: 2"
      }
    ]
  },
  {
    "name": "remember_query_with_limit",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE events FIELDS { \"event_id\": \"int\", \"type\": \"string\" }",
      "STORE events FOR e1 PAYLOAD {\"event_id\":1,\"type\":\"click\"}",
      "STORE events FOR e2 PAYLOAD {\"event_id\":2,\"type\":\"view\"}",
      "STORE events FOR e3 PAYLOAD {\"event_id\":3,\"type\":\"click\"}",
      "FLUSH",
      "REMEMBER QUERY events LIMIT 2 AS limited_events"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "remembered query 'limited_events'"
      },
      {
        "kind": "include",
        "value": "rows stored: 2"
      }
    ]
  },
  {
    "name": "remember_duplicate_name_error",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE test_dup FIELDS { \"id\": \"int\" }",
      "STORE test_dup FOR t1 PAYLOAD {\"id\":1}",
      "FLUSH",
      "REMEMBER QUERY test_dup AS duplicate_test",
      "REMEMBER QUERY test_dup AS duplicate_test"
    ],
    "matcher": {
      "kind": "include",
      "value": "already exists"
    }
  },
  {
    "name": "show_basic_materialization",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE show_test FIELDS { \"id\": \"int\", \"value\": \"string\" }",
      "STORE show_test FOR s1 PAYLOAD {\"id\":1,\"value\":\"first\"}",
      "STORE show_test FOR s2 PAYLOAD {\"id\":2,\"value\":\"second\"}",
      "FLUSH",
      "REMEMBER QUERY show_test AS show_basic",
      "SHOW show_basic"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "s1",
          "s2"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "show_with_incremental_delta",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE delta_test FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE delta_test FOR d1 PAYLOAD {\"id\":1,\"status\":\"initial\"}",
      "STORE delta_test FOR d2 PAYLOAD {\"id\":2,\"status\":\"initial\"}",
      "REMEMBER QUERY delta_test AS delta_materialization",
      "STORE delta_test FOR d3 PAYLOAD {\"id\":3,\"status\":\"new\"}",
      "STORE delta_test FOR d4 PAYLOAD {\"id\":4,\"status\":\"new\"}",
      "SHOW delta_materialization"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "d1",
          "d2",
          "d3",
          "d4"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "show_nonexistent_materialization_error",
    "input_commands": [
      "SHOW nonexistent_materialization"
    ],
    "matcher": {
      "kind": "include",
      "value": "not found"
    },
    "config": {
      "query": {
        "streaming_enabled": true
      }
    }
  },
  {
    "name": "show_multiple_incremental_updates",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE multi_update FIELDS { \"id\": \"int\", \"batch\": \"string\" }",
      "STORE multi_update FOR m1 PAYLOAD {\"id\":1,\"batch\":\"A\"}",
      "REMEMBER QUERY multi_update AS multi_materialization",
      "SHOW multi_materialization",
      "STORE multi_update FOR m2 PAYLOAD {\"id\":2,\"batch\":\"B\"}",
      "SHOW multi_materialization",
      "STORE multi_update FOR m3 PAYLOAD {\"id\":3,\"batch\":\"C\"}",
      "SHOW multi_materialization"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "m1",
          "m2",
          "m3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "remember_and_show_query_with_order_by",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE ordered_test FIELDS { \"id\": \"int\", \"score\": \"int\" }",
      "STORE ordered_test FOR o1 PAYLOAD {\"id\":1,\"score\":50}",
      "STORE ordered_test FOR o2 PAYLOAD {\"id\":2,\"score\":100}",
      "STORE ordered_test FOR o3 PAYLOAD {\"id\":3,\"score\":75}",
      "REMEMBER QUERY ordered_test ORDER BY score DESC AS ordered_materialization",
      "SHOW ordered_materialization"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "o1",
          "o2",
          "o3"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "show_with_where_clause_materialization",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE filtered_test FIELDS { \"id\": \"int\", \"status\": \"string\" }",
      "STORE filtered_test FOR f1 PAYLOAD {\"id\":1,\"status\":\"active\"}",
      "STORE filtered_test FOR f2 PAYLOAD {\"id\":2,\"status\":\"inactive\"}",
      "STORE filtered_test FOR f3 PAYLOAD {\"id\":3,\"status\":\"active\"}",
      "REMEMBER QUERY filtered_test WHERE status=\"active\" AS active_only",
      "SHOW active_only"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "f1",
          "f3"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "f2"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "remember_query_with_context_filter",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE ctx_test FIELDS { \"id\": \"int\", \"value\": \"string\" }",
      "STORE ctx_test FOR user1 PAYLOAD {\"id\":1,\"value\":\"user1_data\"}",
      "STORE ctx_test FOR user2 PAYLOAD {\"id\":2,\"value\":\"user2_data\"}",
      "STORE ctx_test FOR user1 PAYLOAD {\"id\":3,\"value\":\"user1_more\"}",
      "REMEMBER QUERY ctx_test FOR user1 AS user1_materialization"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "remembered query 'user1_materialization'"
      },
      {
        "kind": "include",
        "value": "rows stored: 2"
      }
    ]
  },
  {
    "name": "show_materialization_with_context_filter",
    "config": {
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE ctx_show FIELDS { \"id\": \"int\", \"data\": \"string\" }",
      "STORE ctx_show FOR ctx1 PAYLOAD {\"id\":1,\"data\":\"initial\"}",
      "STORE ctx_show FOR ctx2 PAYLOAD {\"id\":2,\"data\":\"other\"}",
      "REMEMBER QUERY ctx_show FOR ctx1 AS ctx1_materialization",
      "STORE ctx_show FOR ctx1 PAYLOAD {\"id\":3,\"data\":\"new\"}",
      "FLUSH",
      "SHOW ctx1_materialization"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "\"type\":\"schema\""
      },
      {
        "kind": "include_all",
        "value": [
          "ctx1"
        ]
      },
      {
        "kind": "include_none",
        "value": [
          "ctx2"
        ]
      },
      {
        "kind": "include",
        "value": "\"type\":\"end\""
      }
    ]
  },
  {
    "name": "permissions_grant_read_write_single_event_type",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER testuser WITH KEY \"user-key-123\"",
      "GRANT READ, WRITE ON orders TO testuser",
      "SHOW PERMISSIONS FOR testuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read, write"
      }
    ]
  },
  {
    "name": "permissions_grant_read_only",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" })",
      "CREATE USER readonly WITH KEY \"read-key-123\"",
      "GRANT READ ON products TO readonly",
      "SHOW PERMISSIONS FOR readonly"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "products: read"
      },
      {
        "kind": "include_none",
        "value": [
          "write"
        ]
      }
    ]
  },
  {
    "name": "permissions_grant_write_only",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE events FIELDS { \"event_id\": \"int\", \"type\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE events FIELDS { \"event_id\": \"int\", \"type\": \"string\" })",
      "CREATE USER writeonly WITH KEY \"write-key-123\"",
      "GRANT WRITE ON events TO writeonly",
      "SHOW PERMISSIONS FOR writeonly"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "events: write"
      },
      {
        "kind": "include_none",
        "value": [
          "read"
        ]
      }
    ]
  },
  {
    "name": "permissions_grant_multiple_event_types",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" })",
      "CREATE USER multiuser WITH KEY \"multi-key-123\"",
      "GRANT READ, WRITE ON orders, products TO multiuser",
      "SHOW PERMISSIONS FOR multiuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read, write"
      },
      {
        "kind": "include",
        "value": "products: read, write"
      }
    ]
  },
  {
    "name": "permissions_grant_merges_with_existing",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER mergeuser WITH KEY \"merge-key-123\"",
      "GRANT READ ON orders TO mergeuser",
      "GRANT WRITE ON orders TO mergeuser",
      "SHOW PERMISSIONS FOR mergeuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read, write"
      }
    ]
  },
  {
    "name": "permissions_revoke_all_permissions",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER revokeuser WITH KEY \"revoke-key-123\"",
      "GRANT READ, WRITE ON orders TO revokeuser",
      "REVOKE READ, WRITE ON orders FROM revokeuser",
      "SHOW PERMISSIONS FOR revokeuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "has no permissions"
      }
    ]
  },
  {
    "name": "permissions_revoke_partial_read",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER partialuser WITH KEY \"partial-key-123\"",
      "GRANT READ, WRITE ON orders TO partialuser",
      "REVOKE READ ON orders FROM partialuser",
      "SHOW PERMISSIONS FOR partialuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: write"
      },
      {
        "kind": "include_none",
        "value": [
          "read"
        ]
      }
    ]
  },
  {
    "name": "permissions_revoke_partial_write",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER partialwrite WITH KEY \"partialwrite-key-123\"",
      "GRANT READ, WRITE ON orders TO partialwrite",
      "REVOKE WRITE ON orders FROM partialwrite",
      "SHOW PERMISSIONS FOR partialwrite"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read"
      },
      {
        "kind": "include_none",
        "value": [
          "orders: write"
        ]
      }
    ]
  },
  {
    "name": "permissions_revoke_multiple_event_types",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" })",
      "CREATE USER multirevoke WITH KEY \"multirevoke-key-123\"",
      "GRANT READ, WRITE ON orders, products TO multirevoke",
      "REVOKE READ, WRITE ON orders, products FROM multirevoke",
      "SHOW PERMISSIONS FOR multirevoke"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "has no permissions"
      }
    ]
  },
  {
    "name": "permissions_show_empty_permissions",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "CREATE USER emptyuser WITH KEY \"empty-key-123\"",
      "SHOW PERMISSIONS FOR emptyuser"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "has no permissions"
      }
    ]
  },
  {
    "name": "permissions_store_requires_write_permission",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "CREATE USER writer WITH KEY \"writer-key-123\"",
      "GRANT WRITE ON orders TO writer",
      "STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"} user_id=writer signature=HMAC_SHA256(writer-key-123, STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"})"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "OK"
      }
    ]
  },
  {
    "name": "permissions_store_denied_without_write",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "CREATE USER nowrite WITH KEY \"nowrite-key-123\"",
      "GRANT READ ON orders TO nowrite",
      "STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"} user_id=nowrite signature=HMAC_SHA256(nowrite-key-123, STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"})"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Write permission denied for event type 'orders'"
    }
  },
  {
    "name": "permissions_query_requires_read_permission",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" }",
      "STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"} user_id=admin signature=HMAC_SHA256(admin-key-123, STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"})",
      "CREATE USER reader WITH KEY \"reader-key-123\"",
      "GRANT READ ON products TO reader",
      "QUERY products WHERE product_id=1 user_id=reader signature=HMAC_SHA256(reader-key-123, QUERY products WHERE product_id=1)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": ",1,\"Widget\"]"
      }
    ]
  },
  {
    "name": "permissions_query_denied_without_read",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" }",
      "STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"} user_id=admin signature=HMAC_SHA256(admin-key-123, STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"})",
      "CREATE USER noread WITH KEY \"noread-key-123\"",
      "GRANT WRITE ON products TO noread",
      "QUERY products WHERE product_id=1 user_id=noread signature=HMAC_SHA256(noread-key-123, QUERY products WHERE product_id=1)"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Read permission denied for event type 'products'"
    }
  },
  {
    "name": "permissions_admin_can_manage_permissions",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER testuser WITH KEY \"test-key-123\"",
      "GRANT READ, WRITE ON orders TO testuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ, WRITE ON orders TO testuser)",
      "SHOW PERMISSIONS FOR testuser user_id=admin signature=HMAC_SHA256(admin-key-123, SHOW PERMISSIONS FOR testuser)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read, write"
      }
    ]
  },
  {
    "name": "permissions_non_admin_cannot_grant",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER regularuser WITH KEY \"regular-key-123\"",
      "CREATE USER targetuser WITH KEY \"target-key-123\"",
      "GRANT READ, WRITE ON orders TO targetuser user_id=regularuser signature=HMAC_SHA256(regular-key-123, GRANT READ, WRITE ON orders TO targetuser)"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Only admin users can manage permissions"
    }
  },
  {
    "name": "permissions_non_admin_cannot_revoke",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER regularuser WITH KEY \"regular-key-123\"",
      "CREATE USER targetuser WITH KEY \"target-key-123\"",
      "GRANT READ, WRITE ON orders TO targetuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ, WRITE ON orders TO targetuser)",
      "REVOKE READ, WRITE ON orders FROM targetuser user_id=regularuser signature=HMAC_SHA256(regular-key-123, REVOKE READ, WRITE ON orders FROM targetuser)"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Only admin users can manage permissions"
    }
  },
  {
    "name": "permissions_non_admin_cannot_show_permissions",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "CREATE USER regularuser WITH KEY \"regular-key-123\"",
      "CREATE USER targetuser WITH KEY \"target-key-123\"",
      "SHOW PERMISSIONS FOR targetuser user_id=regularuser signature=HMAC_SHA256(regular-key-123, SHOW PERMISSIONS FOR targetuser)"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Only admin users can manage permissions"
    }
  },
  {
    "name": "permissions_define_requires_admin",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "CREATE USER regularuser WITH KEY \"regular-key-123\"",
      "DEFINE test_schema FIELDS { \"id\": \"int\" } user_id=regularuser signature=HMAC_SHA256(regular-key-123, DEFINE test_schema FIELDS { \"id\": \"int\" })"
    ],
    "matcher": {
      "kind": "include",
      "value": "403 Only admin users can define schemas"
    }
  },
  {
    "name": "permissions_admin_can_define_schema",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE test_schema FIELDS { \"id\": \"int\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE test_schema FIELDS { \"id\": \"int\" })"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "OK"
      }
    ]
  },
  {
    "name": "permissions_full_workflow_read_write",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER workflowuser WITH KEY \"workflow-key-123\"",
      "GRANT READ, WRITE ON orders TO workflowuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ, WRITE ON orders TO workflowuser)",
      "STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"} user_id=workflowuser signature=HMAC_SHA256(workflow-key-123, STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"})",
      "QUERY orders WHERE order_id=1 user_id=workflowuser signature=HMAC_SHA256(workflow-key-123, QUERY orders WHERE order_id=1)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "pending"
      }
    ]
  },
  {
    "name": "permissions_grant_to_nonexistent_user_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "GRANT READ, WRITE ON orders TO nonexistent user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ, WRITE ON orders TO nonexistent)"
    ],
    "matcher": {
      "kind": "include",
      "value": "User not found"
    }
  },
  {
    "name": "permissions_revoke_from_nonexistent_user_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "REVOKE READ, WRITE ON orders FROM nonexistent user_id=admin signature=HMAC_SHA256(admin-key-123, REVOKE READ, WRITE ON orders FROM nonexistent)"
    ],
    "matcher": {
      "kind": "include",
      "value": "User not found"
    }
  },
  {
    "name": "permissions_show_nonexistent_user_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "SHOW PERMISSIONS FOR nonexistent user_id=admin signature=HMAC_SHA256(admin-key-123, SHOW PERMISSIONS FOR nonexistent)"
    ],
    "matcher": {
      "kind": "include",
      "value": "User not found"
    }
  },
  {
    "name": "permissions_invalid_permission_name_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER testuser WITH KEY \"test-key-123\"",
      "GRANT EXECUTE ON orders TO testuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT EXECUTE ON orders TO testuser)"
    ],
    "matcher": {
      "kind": "include",
      "value": "Invalid permission"
    }
  },
  {
    "name": "permissions_multiple_grants_same_event_type",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" } user_id=admin signature=HMAC_SHA256(admin-key-123, DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" })",
      "CREATE USER multiuser WITH KEY \"multi-key-123\"",
      "GRANT READ ON orders TO multiuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ ON orders TO multiuser)",
      "GRANT WRITE ON orders TO multiuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT WRITE ON orders TO multiuser)",
      "GRANT READ ON orders TO multiuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ ON orders TO multiuser)",
      "SHOW PERMISSIONS FOR multiuser user_id=admin signature=HMAC_SHA256(admin-key-123, SHOW PERMISSIONS FOR multiuser)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "orders: read, write"
      }
    ]
  },
  {
    "name": "permissions_revoke_nonexistent_permission_no_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "CREATE USER testuser WITH KEY \"test-key-123\"",
      "REVOKE READ, WRITE ON nonexistent_event FROM testuser user_id=admin signature=HMAC_SHA256(admin-key-123, REVOKE READ, WRITE ON nonexistent_event FROM testuser)",
      "SHOW PERMISSIONS FOR testuser user_id=admin signature=HMAC_SHA256(admin-key-123, SHOW PERMISSIONS FOR testuser)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "has no permissions"
      }
    ]
  },
  {
    "name": "permissions_grant_between_commands_takes_effect",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE orders FIELDS { \"order_id\": \"int\", \"status\": \"string\" }",
      "CREATE USER dynamicuser WITH KEY \"dynamic-key-123\"",
      "STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"} user_id=dynamicuser signature=HMAC_SHA256(dynamic-key-123, STORE orders FOR ctx1 PAYLOAD {\"order_id\":1,\"status\":\"pending\"})",
      "GRANT WRITE ON orders TO dynamicuser",
      "STORE orders FOR ctx1 PAYLOAD {\"order_id\":2,\"status\":\"confirmed\"} user_id=dynamicuser signature=HMAC_SHA256(dynamic-key-123, STORE orders FOR ctx1 PAYLOAD {\"order_id\":2,\"status\":\"confirmed\"})"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "403 Write permission denied for event type 'orders'"
      },
      {
        "kind": "include",
        "value": "200 OK"
      }
    ]
  },
  {
    "name": "permissions_grant_read_between_queries_takes_effect",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "DEFINE products FIELDS { \"product_id\": \"int\", \"name\": \"string\" }",
      "STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"} user_id=admin signature=HMAC_SHA256(admin-key-123, STORE products FOR ctx1 PAYLOAD {\"product_id\":1,\"name\":\"Widget\"})",
      "CREATE USER queryuser WITH KEY \"query-key-123\"",
      "QUERY products WHERE product_id=1 user_id=queryuser signature=HMAC_SHA256(query-key-123, QUERY products WHERE product_id=1)",
      "GRANT READ ON products TO queryuser",
      "QUERY products WHERE product_id=1 user_id=queryuser signature=HMAC_SHA256(query-key-123, QUERY products WHERE product_id=1)"
    ],
    "matchers": [
      {
        "kind": "include",
        "value": "403 Read permission denied for event type 'products'"
      },
      {
        "kind": "include",
        "value": ",1,\"Widget\"]"
      }
    ]
  },
  {
    "name": "permissions_grant_to_nonexistent_event_type_error",
    "config": {
      "auth": {
        "bypass_auth": false,
        "initial_admin_user": "admin",
        "initial_admin_key": "admin-key-123"
      },
      "query": {
        "streaming_enabled": true
      }
    },
    "input_commands": [
      "CREATE USER testuser WITH KEY \"test-key-123\"",
      "GRANT READ, WRITE ON nonexistent_event TO testuser user_id=admin signature=HMAC_SHA256(admin-key-123, GRANT READ, WRITE ON nonexistent_event TO testuser)"
    ],
    "matcher": {
      "kind": "include",
      "value": "No schema defined for event type 'nonexistent_event'"
    }
  }
]